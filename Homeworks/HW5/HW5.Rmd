---
title: "PSTAT 174/274 Spring 2023: Homework 5"
author: "Dylan Berneman"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

*Note: {Z~t~} ∼ WN(0, σ~Z~^2^) denotes white noise.*

### Question 1
Create a glossary of R-commands for time series. It should contain all commands that you learned so far in the labs, doing homework, and reviewing posted lecture slides. At the minimum, the glossary should include commands that allow:\
  
  - define working directory
  - read and plot data
  - simulate and plot ARMA models\
  - add trend and mean line to the original time series plot\
  - calculate and plot theoretical acf/pacf for ARMA models\
  - calculate and plot sample acf/pacf\
  - check whether a particular model is\ causal/invertible (R commands to find and plot roots of polynomials)\
  - perform Box-Cox transforms\
  - perform differencing data at lags 1 and 12\
  - perform Yule-Walker estimation and find standard deviations of the estimates\
  - perform MLE and check AICC associated with the model\

#### Packages
```{r message=FALSE, warning=FALSE}
# Install and activate the following R-packages:

library(astsa)
#Applied Statistical Time Series Analysis

devtools::install_github("FinYang/tsdl")
library(tsdl)
# Practice time series

library(distributional)
# Vectorised distribution objects with tools for manipulating, visualizing, and using probability distributions. Designed to allow model prediction outputs to return distributions rather than their parameters, allowing users to directly interact with predictive distributions in a data-oriented workflow. 

library(FinTS)
# Plot the theoretical ACF corresponding to an ARMA model

library(FitARMA)
# mplements fast maximum likelihood algorithm for fitting ARMA time series.

library(forecast) 
# Methods and tools for displaying and analysing univariate time series forecasts including exponential smoothing via state space models and automatic ARIMA modelling.

library(latex2exp)
# Use LaTeX Expressions in Plots

library(polynom)
# A Collection of Functions to Implement a Class for Univariate Polynomial Manipulations

library(readr)
# Read in data

library(sarima)
# Functions, classes and methods for time series modelling with ARIMA and related models. 

library(tinytex)
# Helper Functions to Install and Maintain TeX Live, and Compile LaTeX Documents
```  

#### Read and Plot Data

read.csv(file = , header)\

  - *`Read` in data (file must be in the same working directory)*\
```{r}
uspop = read.csv("uspop.txt", header=FALSE)
head(uspop, 5)
```
\
ts(data = " ", start = numeric(0), end = numeric(0), frequency = numeric(0))\

  - *`data` must be a vector, matrix, or data frame*
  - *`start` is the time of the 1^st^ observation*
  - *`frequency` is the number of observations per unit of time*
\

\
plot(x, y, xlab = "...", ylab = "...", xlim = c( ), ylim = c( ), main = TeX( ), col = "...")\

  - *`TeX(r'(...$ code $...)')` Render text w/ latex code in place of a string*
  - *`xlab` changes the x-axis label*
  - *`ylab` changes the y-axis label*
  - *`xlim` specify the values on the x-axis*
  - *`ylim` specify the values on the y-axis*
  - *`main` changes the title of the plot*
  - *`col` changes the color of the line*
  - *can also use `plot.ts()` or `ts.plot()`*

```{r, out.width = "30%", fig.align='center'}
data = data.frame("months"=0:24)
data = ts(data, start=1920, end = 1922, frequency=12)
ts.plot(data, main=TeX(r'($\phi$)'), col="red")
```


### Simulate and Plot ARMA models
auto.arima(y, d, D, max.p, max.q, max.P, max.Q, max.d, max.D, start.p, start.q, start.P, start.Q, stationary, seasonal, , allowmean, ic)\

  - *Use to fit and estimate model coefficients and parameters using an existing time series *
  - *`y` a univariate time series*
  - *`d` Order of first-differencing. If missing, will choose a value based on test.*
  - *`D` Order of seasonal-differencing. If missing, will choose a value based on season.test.*
  - *`max.p` Maximum value of p*
  - *`max.q` Maximum value of q*
  - *`max.P` Maximum value of P*
  - *`max.Q` Maximum value of Q*
  - *`max.d` Maximum value of d*
  - *`max.D` Maximum value of D*
  - *`start.p` Starting value of p*
  - *`start.q` Starting value of q*
  - *`start.P` Starting value of P*
  - *`start.Q` Starting value of Q*
  - *`stationary` If TRUE, restricts search to stationary models.*
  - *`seasonal` If FALSE, restricts search to non-seasonal models.*
  - *`ic` Information criterion to be used in model selection. c("aicc", "aic", "bic")*
  - *`allowmean`	If TRUE, models with a non-zero mean are considered.*
\

asta::sarima(xdata, p, d, q, P, D, Q, S, fixed)\

  - *`xdata`	univariate time series*
  - *`p` AR order (must be specified)*
  - *`d` difference order (must be specified)*
  - *`q` MA order (must be specified)*
  - *`P` SAR order; use only for seasonal models*
  - *`D` seasonal difference; use only for seasonal models*
  - *`Q` SMA order; use only for seasonal models*
  - *`S` seasonal period; use only for seasonal models*
  - *`fixed` model with specified coefficients; see `sarima.sim`*
\

sarima.sim(ar, d, ma, sar, D, sma, S, n, innov)\

  - *`ar` coefficients of AR component (does not have to be specified)*
  - *`d` order of regular difference (does not have to be specified)*
  - *`ma` coefficients of MA component (does not have to be specified)*
  - *`sar` coefficients of SAR component (does not have to be specified)*
  - *`D` order of seasonal difference (does not have to be specified)*
  - *`sma` coefficients of SMA component (does not have to be specified)*
  - *`S` seasonal period (does not have to be specified)*
  - *`n` desired sample size (defaults to 500)*
  - *`innov` an optional times series of innovations. If not provided, rand.gen is used.*
\

sarima.for(n.ahead, *same as sarima*)\

  - *`n.ahead` forecast horizon (number of periods)*
\

```{r}
milk <- subset(tsdl, 12, "Agriculture")[[3]] 

x = auto.arima(milk, trace = TRUE, D=1, start.p = 0, start.q = 0, start.P = 0, start.Q = 0, seasonal = TRUE)
arima.sim
plot(x$x-x$fitted)
plot(x$residuals)
y = astsa::sarima(milk, 0,1,0,0,1,0,12)
plot(y$fit$residuals)
points(type="l", x$residuals, col="red")


sarima.sim(innov)

# x=GetFitARMA(milk, p=2, q=0)
# ImpulseCoefficientsARMA(phi=c(0.9, -0.4), theta = c(0,0.8), 20)
# ARMAacf(ar=c(0.9,-0.4), ma=c(0,0.8), pacf = TRUE, lag.max = 9)
# tacvfARMA(phi=c(0.2, -0.6), theta = c(0.5, 0.6), maxLag = 10)
# TacvfARMA(phi=c(01.2, -0.6), theta = c(0.5, 0.6), lag.max = 10)
# x
# 
# polyroot(c(1,3,2))
# x$fits
# plot(milk)
# plot(x$fits)
# acf2(milk)
milk <- subset(tsdl, 12, "Agriculture")[[3]] 
InvertibleQ(c(0.8, -0.5))

```

### Functions

**polyroot(c, b, a,...)**
From: (a(1) - b(B) - c(B^2^)...)(X~t~ or Z~t~)
For X~t~, time series is causal/stationary if |a, b, c| > 1
For Z~t~, time series is invertible if |a, b, c| > 1

```{r}
signature(object = "Autocorrelations", convention = "ComboAutocorrelations", component = "missing")

signature(object = "Autocorrelations", convention = "ComboAutocorrelations", component = "missing") 

signature(object = "Autocorrelations", convention = "PartialAutocorrelations", component = "missing") 

signature(object = "Autocovariances", convention = "Autocorrelations", component = "missing") 

signature(object = "Autocovariances", convention = "ComboAutocorrelations", component = "missing")
  
signature(object = "Autocovariances", convention = "ComboAutocovariances", component = "missing")

signature(object = "Autocovariances", convention = "PartialAutocorrelations", component = "missing") 

signature(object = "ComboAutocorrelations", convention = "Autocorrelations", component = "missing") 

signature(object = "ComboAutocorrelations", convention = "PartialAutocorrelations", component = "missing")

signature(object = "ComboAutocovariances", convention = "Autocovariances", component = "missing") 

signature(object = "ComboAutocovariances", convention = "PartialAutocovariances", component = "missing") 

signature(object = "ComboAutocovariances", convention = "PartialVariances", component = "missing") 

signature(object = "ComboAutocovariances", convention = "VirtualAutocovariances", component = "missing") 

signature(object = "PartialAutocorrelations", convention = "Autocorrelations", component = "missing") 

signature(object = "SarimaModel", convention = "ArFilter", component = "missing")

signature(object = "SarimaModel", convention = "ArmaFilter", component = "missing")

signature(object = "SarimaModel", convention = "MaFilter", component = "missing") 

signature(object = "SarimaModel", convention = "SarimaFilter", component = "missing")

signature(object = "VirtualAutocovariances", convention = "character", component = "missing") 

signature(object = "VirtualAutocovariances", convention = "missing", component = "missing") 

signature(object = "VirtualAutocovariances", convention = "VirtualAutocovariances", component = "missing")

signature(object = "SarimaModel", convention = "ArModel", component = "missing") 

signature(object = "SarimaModel", convention = "MaModel", component = "missing") 

signature(object = "VirtualFilterModel", convention = "BD", component = "missing") 

signature(object = "VirtualFilterModel", convention = "BJ", component = "missing") 

signature(object = "VirtualFilterModel", convention = "character", component = "missing")

signature(object = "VirtualFilterModel", convention = "missing", component = "missing")

signature(object = "VirtualFilterModel", convention = "SP", component = "missing")

signature(object = "ArmaModel", convention = "ArmaFilter", component = "missing")

signature(object = "VirtualAutocovariances", convention = "Autocovariances", component = "missing")
```
  
  
2. Choose a dataset that you will be interested to analyze for your class final project. URLs of time series libraries are posted on Gaucho Space. Provide the following information about the project:
(a) Data set description: briefly describe the data set you plan to use in your project.
(b) Motivation and objectives: briefly explain why this data set is interesting or important. Provide a clear description of the problem you plan to address using this dataset (for example to forecast).
(c) Plot and examine the main features of the graph, checking in particular whether there is (i) a trend; (ii) a seasonal component, (iii) any apparent sharp changes in behavior. Explain in detail.
(d) Use any necessary transformations to get stationary series. Give a detailed explanation to justify your choice of a particular procedure. If you have used transformation, justify why. If you have used differencing, what lag did you use? Why? Is your series stationary now?
(e) Plot and analyze the ACF and PACF to preliminary identify your model(s): Plot ACF/PACF. What model(s) do they suggest? Explain your choice of p and q here.
If your dataset does not work for you, please comment why. For example, the dataset is too short, exhibits change of behavior, does not look like a second-order process, etc. You might review slide 47 of Week 4, Lecture 8.
Note that you may change the project dataset in the future. This question is designed to help you start planning your the project. Please include plots of corresponding theoretical acfs and the corresponding R code.
3. An ARMA(3, 0) model is fit to the following quarterly time series:
  The estimated coefficients are:
ar1 ar2 0.252 0.061
ar3 intercept -0.202 2.637
Year 2018 2019 2020
Quarter 1 3.53
0.98 2.91
Quarter 2 1.33
3.61 2.12
Quarter 3 1.85 3.44 4.62
Quarter 4 0.61 3.38 2.93
      Forecast the value for Quarter 1 of 2021. Give full explanation on how you arrived to your answer. Show calculations.
A. Less that 3.00 B. At least 3.00, but less than 3.25 C. At least 3.25, but less than 3.50 D. Atleast 3.50, but less than 3.75 E. At least 3.75.
Important: For models with AR part, the ”intercept” reported in standard output of R is a misnomer. It is actually the mean of the process, so that the fitted model is
Xt − 2.637 = 0.252(Xt−1 − 2.637) + 0.061(Xt−2 − 2.637) − 0.202(Xt−3 − 2.637) + Zt.
4. You are given the following information about an AR(1) model with mean 0: ρ(2) = 0.215, ρ(3) = −0.100, XT = −0.431. Calculate the forecasted value of XT+1.
5. The five models, AR(1), ARMA(1, 1), ARMA(1, 2), ARMA(2, 3), and ARMA(4, 3) are fitted to the same time series.
The models are ranked using Akaike Information Criterion (AIC): AIC
Model Loglikelihood
You are given the following information:
Determine the best model.
= −2× log-likelihood+2 ×(p + q + 2).
   AR(1)
ARMA(1, 1) -641
ARMA(1, 2) -636
ARMA(2, 3) -630
ARMA(4, 3) -629
-650
  The following problems are for students enrolled in PSTAT 274 ONLY
G1. Suppose that in a sample of size 100, we obtain ρˆ(1) = 0.438 and ρˆ(2) = 0.145. Assuming that the data were generated from an MA(1) model, construct approximate 95% confidence intervals for both ρ(1) and ρ(2). Based on these two confidence intervals, are the data consistent with an MA(1) model with θ = 0.6?
Help: (i) Bartlett’s formula, was discussed in §10.3, slides 52, 55 and 56, of week 4. It gives distribution of sample acfs: For
h
is approximately N(ρ,n−1W) with the elements of matrix W computed by Bartelett’s formula:
∞
large sample size n, ρˆwij =X{ρ(k+i)+ρ(k−i)−2ρ(i)ρ(k)}×{ρ(k+j)+ρ(k−j)−2ρ(j)ρ(k)}
(ii) The acf of MA(1) model was calculated in §3.2, week 1, see slide 64.
(iii) To write confidence intervals for ρ(1) and ρ(2) you need to compute wii for i = 1,2 from Bartlett’s formula. For example, for MA(1) one gets w11 = 1 − 3ρ(1)2 + 4ρ(1)4. Recall that wii = 1 + 2ρ(1)2 for i > 1 (Why?).
