---
title: "Project"
author: "Dylan Berneman"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
install.packages('astsa')
install.packages('tseries')
install.packages('basicTrendline')
install.packages("UnitCircle")
install.packages("nortsTest")
install.packages("sae")
install.packages("nortest")
install.packages('distributional')
install.packages("TSA")
install.packages("AICcmodavg")
install.packages('FinTS')
install.packages('FitAR')
install.packages("forecast")
install.packages("Dict")
install.packages('ggplot2')
install.packages("ggfortify")
install.packages('latex2exp')
install.packages('polynom')
install.packages('sarima')
install.packages("MuMIn")
# devtools::install_github("FinYang/tsdl")
library(devtools)
library(tseries)
library(UnitCircle)
library(Dict)
library(backports)
library(nortsTest)
library(sae)
library(nortest)
library(TSA)
library(MuMIn)
library(astsa)
library(basicTrendline)
# library(tsdl)
library(dplyr)
library(FinTS)
library(FitAR)
library(forecast)
library(ggplot2)
library(latex2exp)
library(ggfortify)
library(MASS)
library(polynom)
library(readr)
library(readxl)
library(sarima)
library(tinytex)

```
\

We will be testing the datasets corresponding to:\
  - The smoothed amount of daily new COVID cases (Cases)
  - The smoothed amount of daily new deaths from COVID (Deathss)
  - The daily mortality rate of those who contract COVID (Mortality)
  - The daily percent of the world that has been vaccinated (Vaccinated)\
\

For each data set, the length of the time series will be evaluated in at most 3 ways:\
  - [January 8, 2020 - May 24, 2023]
    - Cases will begin on the 6th observation day, January 8, 2020, since there were some observations of 0 new cases before then
  - [January 12, 2020 - May 24, 2023]
    - Deaths and Mortality will begin on the 10th observation day, January 12, 2020, since that was the time of the first death
  - [January 8, 2020 - December 3, 2020]
    - This will account for all daily observations of Cases before the first person got vaccinated
  - [January 12, 2020 - December 3, 2020]
    - This will account for all daily observations for Deaths and Mortality before the first person got vaccinated
  - [December 4, 2020 - May 24, 2023]
    - This will account for all daily observations for Cases, Deaths, Mortality, and Vaccinated since the first person got vaccinated.\
\

Additionally, since daily observations can be very noisy, we will also be testing the weekly average for each of the previously mentioned time series. In total, that will be 20 data sets.\
\

In regards to the names of the data sets:\
  - '1' refers to the entire pandemic
  - '2' refers to the time before the first vaccination
  - '3' refers to the time since the first vaccination
  - 'a' denotes daily observations
  - 'b' denotes average weekly observations\
\

# Original Datasets
```{r}
options(scipen = 9)
covid <- read_excel("World_Covid.xlsx")


# Cases: [January 8, 2020 - May 24, 2023]
  # Daily
Cases1a = ts(covid$new_cases_smoothed[6:1238])
Cases1a= data.frame(Cases1a)
  # Weekly
Cases1b=vector()
for(i in 1:176){
  x = 7 * (i-1) + 1
  y = 7 * i
  Cases1b <- append(Cases1b, mean(Cases1a[x:y, 1]))
  Cases1b = ts(Cases1b)}
Cases1b = data.frame(Cases1b)
  # Bi-Daily
Cases1c=vector()
for(i in 1:616){
  x = 2 * (i-1) + 1
  y = 2 * i
  Cases1c <- append(Cases1c, mean(Cases1a[x:y, 1]))
  Cases1c = ts(Cases1c)}
Cases1c = data.frame(Cases1c)
  # Tri-Daily
Cases1d=vector()
for(i in 1:410){
  x = 3 * (i-1) + 1
  y = 3 * i
  Cases1d <- append(Cases1d, mean(Cases1a[x:y, 1]))
  Cases1d = ts(Cases1d)}
Cases1d = data.frame(Cases1d)
  # Quad-Daily
Cases1e=vector()
for(i in 1:308){
  x = 4 * (i-1) + 1
  y = 4 * i
  Cases1e <- append(Cases1e, mean(Cases1a[x:y, 1]))
  Cases1e = ts(Cases1e)}
Cases1e = data.frame(Cases1e)
  # Penta-Daily
Cases1f=vector()
for(i in 1:246){
  x = 5 * (i-1) + 1
  y = 5 * i
  Cases1f <- append(Cases1f, mean(Cases1a[x:y, 1]))
  Cases1f = ts(Cases1f)}
Cases1f = data.frame(Cases1f)
  # Sext-Daily
Cases1g=vector()
for(i in 1:205){
  x = 6 * (i-1) + 1
  y = 6 * i
  Cases1g <- append(Cases1g, mean(Cases1a[x:y, 1]))
  Cases1g = ts(Cases1g)}
Cases1g = data.frame(Cases1g)


# Deaths: [January 12, 2020 - May 24, 2023]
  # Daily
Deaths1a = ts(covid$new_deaths_smoothed[10:1238])
Deaths1a= data.frame(Deaths1a)
  # Weekly
Deaths1b=vector()
for(i in 1:175){
  x = 7 * (i-1) + 1
  y = 7 * i
  Deaths1b <- append(Deaths1b, mean(Deaths1a[x:y, 1]))
  Deaths1b = ts(Deaths1b)}
Deaths1b = data.frame(Deaths1b)
  # Bi-Daily
Deaths1c=vector()
for(i in 1:614){
  x = 2 * (i-1) + 1
  y = 2 * i
  Deaths1c <- append(Deaths1c, mean(Deaths1a[x:y, 1]))
  Deaths1c = ts(Deaths1c)}
Deaths1c = data.frame(Deaths1c)
  # Tri-Daily
Deaths1d=vector()
for(i in 1:409){
  x = 3 * (i-1) + 1
  y = 3 * i
  Deaths1d <- append(Deaths1d, mean(Deaths1a[x:y, 1]))
  Deaths1d = ts(Deaths1d)}
Deaths1d = data.frame(Deaths1d)
  # Quad-Daily
Deaths1e=vector()
for(i in 1:307){
  x = 4 * (i-1) + 1
  y = 4 * i
  Deaths1e <- append(Deaths1e, mean(Deaths1a[x:y, 1]))
  Deaths1e = ts(Deaths1e)}
Deaths1e = data.frame(Deaths1e)
  # Penta-Daily
Deaths1f=vector()
for(i in 1:245){
  x = 5 * (i-1) + 1
  y = 5 * i
  Deaths1f <- append(Deaths1f, mean(Deaths1a[x:y, 1]))
  Deaths1f = ts(Deaths1f)}
Deaths1f = data.frame(Deaths1f)
  # Sext-Daily
Deaths1g=vector()
for(i in 1:204){
  x = 6 * (i-1) + 1
  y = 6 * i
  Deaths1g <- append(Deaths1g, mean(Deaths1a[x:y, 1]))
  Deaths1g = ts(Deaths1g)}
Deaths1g = data.frame(Deaths1g)


# Mortality: [January 12, 2020 - May 24, 2023]
  # Daily
Mort1a = ts(covid$Mortality[10:1238])
Mort1a= data.frame(Mort1a)
  # Weekly
Mort1b=vector()
for(i in 1:175){
  x = 7 * (i-1) + 1
  y = 7 * i
  Mort1b <- append(Mort1b, mean(Mort1a[x:y, 1]))
  Mort1b = ts(Mort1b)}
Mort1b = data.frame(Mort1b)
  # Bi-Daily
Mort1c=vector()
for(i in 1:614){
  x = 2 * (i-1) + 1
  y = 2 * i
  Mort1c <- append(Mort1c, mean(Mort1a[x:y, 1]))
  Mort1c = ts(Mort1c)}
Mort1c = data.frame(Mort1c)
  # Tri-Daily
Mort1d=vector()
for(i in 1:409){
  x = 3 * (i-1) + 1
  y = 3 * i
  Mort1d <- append(Mort1d, mean(Mort1a[x:y, 1]))
  Mort1d = ts(Mort1d)}
Mort1d = data.frame(Mort1d)
  # Quad-Daily
Mort1e=vector()
for(i in 1:307){
  x = 4 * (i-1) + 1
  y = 4 * i
  Mort1e <- append(Mort1e, mean(Mort1a[x:y, 1]))
  Mort1e = ts(Mort1e)}
Mort1e = data.frame(Mort1e)
  # Penta-Daily
Mort1f=vector()
for(i in 1:245){
  x = 5 * (i-1) + 1
  y = 5 * i
  Mort1f <- append(Mort1f, mean(Mort1a[x:y, 1]))
  Mort1f = ts(Mort1f)}
Mort1f = data.frame(Mort1f)
  # Sext-Daily
Mort1g=vector()
for(i in 1:204){
  x = 6 * (i-1) + 1
  y = 6 * i
  Mort1g <- append(Mort1g, mean(Mort1a[x:y, 1]))
  Mort1g = ts(Mort1g)}
Mort1g = data.frame(Mort1g)


# Cases: [January 8, 2020 - December 3, 2020]
  # Daily
Cases2a = ts(covid$new_cases_smoothed[6:336])
Cases2a= data.frame(Cases2a)
  # Weekly
Cases2b=vector()
for(i in 1:47){
  x = 7 * (i-1) + 1
  y = 7 * i
  Cases2b <- append(Cases2b, mean(Cases2a[x:y, 1]))
  Cases2b = ts(Cases2b)}
Cases2b = data.frame(Cases2b)
  # Bi-Daily
Cases2c=vector()
for(i in 1:165){
  x = 2 * (i-1) + 1
  y = 2 * i
  Cases2c <- append(Cases2c, mean(Cases2a[x:y, 1]))
  Cases2c = ts(Cases2c)}
Cases2c = data.frame(Cases2c)
  # Tri-Daily
Cases2d=vector()
for(i in 1:110){
  x = 3 * (i-1) + 1
  y = 3 * i
  Cases2d <- append(Cases2d, mean(Cases2a[x:y, 1]))
  Cases2d = ts(Cases2d)}
Cases2d = data.frame(Cases2d)
  # Quad-Daily
Cases2e=vector()
for(i in 1:82){
  x = 4 * (i-1) + 1
  y = 4 * i
  Cases2e <- append(Cases2e, mean(Cases2a[x:y, 1]))
  Cases2e = ts(Cases2e)}
Cases2e = data.frame(Cases2e)
  # Penta-Daily
Cases2f=vector()
for(i in 1:66){
  x = 5 * (i-1) + 1
  y = 5 * i
  Cases2f <- append(Cases2f, mean(Cases2a[x:y, 1]))
  Cases2f = ts(Cases2f)}
Cases2f = data.frame(Cases2f)


# Deaths: [January 12, 2020 - December 3, 2020]
  # Daily
Deaths2a = ts(covid$new_deaths_smoothed[10:336])
Deaths2a= data.frame(Deaths2a)
  # Weekly
Deaths2b=vector()
for(i in 1:46){
  x = 7 * (i-1) + 1
  y = 7 * i
  Deaths2b <- append(Deaths2b, mean(Deaths2a[x:y, 1]))
  Deaths2b = ts(Deaths2b)}
Deaths2b = data.frame(Deaths2b)
  # Bi-Daily
Deaths2c=vector()
for(i in 1:163){
  x = 2 * (i-1) + 1
  y = 2 * i
  Deaths2c <- append(Deaths2c, mean(Deaths2a[x:y, 1]))
  Deaths2c = ts(Deaths2c)}
Deaths2c = data.frame(Deaths2c)
  # Tri-Daily
Deaths2d=vector()
for(i in 1:108){
  x = 3 * (i-1) + 1
  y = 3 * i
  Deaths2d <- append(Deaths2d, mean(Deaths2a[x:y, 1]))
  Deaths2d = ts(Deaths2d)}
Deaths2d = data.frame(Deaths2d)
  # Quad-Daily
Deaths2e=vector()
for(i in 1:81){
  x = 4 * (i-1) + 1
  y = 4 * i
  Deaths2e <- append(Deaths2e, mean(Deaths2a[x:y, 1]))
  Deaths2e = ts(Deaths2e)}
Deaths2e = data.frame(Deaths2e)
  # Penta-Daily
Deaths2f=vector()
for(i in 1:65){
  x = 5 * (i-1) + 1
  y = 5 * i
  Deaths2f <- append(Deaths2f, mean(Deaths2a[x:y, 1]))
  Deaths2f = ts(Deaths2f)}
Deaths2f = data.frame(Deaths2f)


# Mortality: [January 12, 2020 - December 3, 2020]
  # Daily
Mort2a = ts(covid$Mortality[10:336])
Mort2a= data.frame(Mort2a)
  # Weekly
Mort2b=vector()
for(i in 1:46){
  x = 7 * (i-1) + 1
  y = 7 * i
  Mort2b <- append(Mort2b, mean(Mort2a[x:y, 1]))
  Mort2b = ts(Mort2b)}
Mort2b = data.frame(Mort2b)
  # Bi-Daily
Mort2c=vector()
for(i in 1:163){
  x = 2 * (i-1) + 1
  y = 2 * i
  Mort2c <- append(Mort2c, mean(Mort2a[x:y, 1]))
  Mort2c = ts(Mort2c)}
Mort2c = data.frame(Mort2c)
  # Tri-Daily
Mort2d=vector()
for(i in 1:108){
  x = 3 * (i-1) + 1
  y = 3 * i
  Mort2d <- append(Mort2d, mean(Mort2a[x:y, 1]))
  Mort2d = ts(Mort2d)}
Mort2d = data.frame(Mort2d)
  # Quad-Daily
Mort2e=vector()
for(i in 1:81){
  x = 4 * (i-1) + 1
  y = 4 * i
  Mort2e <- append(Mort2e, mean(Mort2a[x:y, 1]))
  Mort2e = ts(Mort2e)}
Mort2e = data.frame(Mort2e)
  # Penta-Daily
Mort2f=vector()
for(i in 1:65){
  x = 5 * (i-1) + 1
  y = 5 * i
  Mort2f <- append(Mort2f, mean(Mort2a[x:y, 1]))
  Mort2f = ts(Mort2f)}
Mort2f = data.frame(Mort2f)



# Cases: [January 8, 2020 - April 4, 2021]
  # Daily
Cases2_5a = ts(covid$new_cases_smoothed[6:458])
Cases2_5a= data.frame(Cases2_5a)
  # Weekly
Cases2_5b=vector()
for(i in 1:64){
  x = 7 * (i-1) + 1
  y = 7 * i
  Cases2_5b <- append(Cases2_5b, mean(Cases2_5a[x:y, 1]))
  Cases2_5b = ts(Cases2_5b)}
Cases2_5b = data.frame(Cases2_5b)
  # Bi-Daily
Cases2_5c=vector()
for(i in 1:226){
  x = 2 * (i-1) + 1
  y = 2 * i
  Cases2_5c <- append(Cases2_5c, mean(Cases2_5a[x:y, 1]))
  Cases2_5c = ts(Cases2_5c)}
Cases2_5c = data.frame(Cases2_5c)
  # Tri-Daily
Cases2_5d=vector()
for(i in 1:150){
  x = 3 * (i-1) + 1
  y = 3 * i
  Cases2_5d <- append(Cases2_5d, mean(Cases2_5a[x:y, 1]))
  Cases2_5d = ts(Cases2_5d)}
Cases2_5d = data.frame(Cases2_5d)
  # Quad-Daily
Cases2_5e=vector()
for(i in 1:113){
  x = 4 * (i-1) + 1
  y = 4 * i
  Cases2_5e <- append(Cases2_5e, mean(Cases2_5a[x:y, 1]))
  Cases2_5e = ts(Cases2_5e)}
Cases2_5e = data.frame(Cases2_5e)
  # Penta-Daily
Cases2_5f=vector()
for(i in 1:90){
  x = 5 * (i-1) + 1
  y = 5 * i
  Cases2_5f <- append(Cases2_5f, mean(Cases2_5a[x:y, 1]))
  Cases2_5f = ts(Cases2_5f)}
Cases2_5f = data.frame(Cases2_5f)
  # Sext-Daily
Cases2_5g=vector()
for(i in 1:75){
  x = 6 * (i-1) + 1
  y = 6 * i
  Cases2_5g <- append(Cases2_5g, mean(Cases2_5a[x:y, 1]))
  Cases2_5g = ts(Cases2_5g)}
Cases2_5g = data.frame(Cases2_5g)


# Deaths: [January 12, 2020 - April 4, 2021]
  # Daily
Deaths2_5a = ts(covid$new_deaths_smoothed[10:458])
Deaths2_5a= data.frame(Deaths2_5a)
  # Weekly
Deaths2_5b=vector()
for(i in 1:64){
  x = 7 * (i-1) + 1
  y = 7 * i
  Deaths2_5b <- append(Deaths2_5b, mean(Deaths2_5a[x:y, 1]))
  Deaths2_5b = ts(Deaths2_5b)}
Deaths2_5b = data.frame(Deaths2_5b)
  # Bi-Daily
Deaths2_5c=vector()
for(i in 1:224){
  x = 2 * (i-1) + 1
  y = 2 * i
  Deaths2_5c <- append(Deaths2_5c, mean(Deaths2_5a[x:y, 1]))
  Deaths2_5c = ts(Deaths2_5c)}
Deaths2_5c = data.frame(Deaths2_5c)
  # Tri-Daily
Deaths2_5d=vector()
for(i in 1:149){
  x = 3 * (i-1) + 1
  y = 3 * i
  Deaths2_5d <- append(Deaths2_5d, mean(Deaths2_5a[x:y, 1]))
  Deaths2_5d = ts(Deaths2_5d)}
Deaths2_5d = data.frame(Deaths2_5d)
  # Quad-Daily
Deaths2_5e=vector()
for(i in 1:112){
  x = 4 * (i-1) + 1
  y = 4 * i
  Deaths2_5e <- append(Deaths2_5e, mean(Deaths2_5a[x:y, 1]))
  Deaths2_5e = ts(Deaths2_5e)}
Deaths2_5e = data.frame(Deaths2_5e)
  # Penta-Daily
Deaths2_5f=vector()
for(i in 1:89){
  x = 5 * (i-1) + 1
  y = 5 * i
  Deaths2_5f <- append(Deaths2_5f, mean(Deaths2_5a[x:y, 1]))
  Deaths2_5f = ts(Deaths2_5f)}
Deaths2_5f = data.frame(Deaths2_5f)
  # Sext-Daily
Deaths2_5g=vector()
for(i in 1:74){
  x = 6 * (i-1) + 1
  y = 6 * i
  Deaths2_5g <- append(Deaths2_5g, mean(Deaths2_5a[x:y, 1]))
  Deaths2_5g = ts(Deaths2_5g)}
Deaths2_5g = data.frame(Deaths2_5g)


# Mortality: [January 12, 2020 - April 4, 2021]
  # Daily
Mort2_5a = ts(covid$Mortality[10:458])
Mort2_5a= data.frame(Mort2_5a)
  # Weekly
Mort2_5b=vector()
for(i in 1:64){
  x = 7 * (i-1) + 1
  y = 7 * i
  Mort2_5b <- append(Mort2_5b, mean(Mort2_5a[x:y, 1]))
  Mort2_5b = ts(Mort2_5b)}
Mort2_5b = data.frame(Mort2_5b)
  # Bi-Daily
Mort2_5c=vector()
for(i in 1:224){
  x = 2 * (i-1) + 1
  y = 2 * i
  Mort2_5c <- append(Mort2_5c, mean(Mort2_5a[x:y, 1]))
  Mort2_5c = ts(Mort2_5c)}
Mort2_5c = data.frame(Mort2_5c)
  # Tri-Daily
Mort2_5d=vector()
for(i in 1:149){
  x = 3 * (i-1) + 1
  y = 3 * i
  Mort2_5d <- append(Mort2_5d, mean(Mort2_5a[x:y, 1]))
  Mort2_5d = ts(Mort2_5d)}
Mort2_5d = data.frame(Mort2_5d)
  # Quad-Daily
Mort2_5e=vector()
for(i in 1:112){
  x = 4 * (i-1) + 1
  y = 4 * i
  Mort2_5e <- append(Mort2_5e, mean(Mort2_5a[x:y, 1]))
  Mort2_5e = ts(Mort2_5e)}
Mort2_5e = data.frame(Mort2_5e)
  # Penta-Daily
Mort2_5f=vector()
for(i in 1:89){
  x = 5 * (i-1) + 1
  y = 5 * i
  Mort2_5f <- append(Mort2_5f, mean(Mort2_5a[x:y, 1]))
  Mort2_5f = ts(Mort2_5f)}
Mort2_5f = data.frame(Mort2_5f)
  # Sext-Daily
Mort2_5g=vector()
for(i in 1:74){
  x = 6 * (i-1) + 1
  y = 6 * i
  Mort2_5g <- append(Mort2_5g, mean(Mort2_5a[x:y, 1]))
  Mort2_5g = ts(Mort2_5g)}
Mort2_5g = data.frame(Mort2_5g)



# Cases: [December 4, 2020 - May 24, 2023]
  # Daily
Cases3a = ts(covid$new_cases_smoothed[337:1238])
Cases3a= data.frame(Cases3a)
  # Weekly
Cases3b=vector()
for(i in 1:128){
  x = 7 * (i-1) + 1
  y = 7 * i
  Cases3b <- append(Cases3b, mean(Cases3a[x:y, 1]))
  Cases3b = ts(Cases3b)}
Cases3b = data.frame(Cases3b)
  # Bi-Daily
Cases3c=vector()
for(i in 1:450){
  x = 2 * (i-1) + 1
  y = 2 * i
  Cases3c <- append(Cases3c, mean(Cases3a[x:y, 1]))
  Cases3c = ts(Cases3c)}
Cases3c = data.frame(Cases3c)
  # Tri-Daily
Cases3d=vector()
for(i in 1:300){
  x = 3 * (i-1) + 1
  y = 3 * i
  Cases3d <- append(Cases3d, mean(Cases3a[x:y, 1]))
  Cases3d = ts(Cases3d)}
Cases3d = data.frame(Cases3d)
  # Quad-Daily
Cases3e=vector()
for(i in 1:225){
  x = 4 * (i-1) + 1
  y = 4 * i
  Cases3e <- append(Cases3e, mean(Cases3a[x:y, 1]))
  Cases3e = ts(Cases3e)}
Cases3e = data.frame(Cases3e)
  # Penta-Daily
Cases3f=vector()
for(i in 1:180){
  x = 5 * (i-1) + 1
  y = 5 * i
  Cases3f <- append(Cases3f, mean(Cases3a[x:y, 1]))
  Cases3f = ts(Cases3f)}
Cases3f = data.frame(Cases3f)
  # Sext-Daily
Cases3g=vector()
for(i in 1:150){
  x = 6 * (i-1) + 1
  y = 6 * i
  Cases3g <- append(Cases3g, mean(Cases3a[x:y, 1]))
  Cases3g = ts(Cases3g)}
Cases3g = data.frame(Cases3g)


# Deaths: [December 4, 2020 - May 24, 2023]
  # Daily
Deaths3a = ts(covid$new_deaths_smoothed[337:1238])
Deaths3a= data.frame(Deaths3a)
  # Weekly
Deaths3b=vector()
for(i in 1:128){
  x = 7 * (i-1) + 1
  y = 7 * i
  Deaths3b <- append(Deaths3b, mean(Deaths3a[x:y, 1]))
  Deaths3b = ts(Deaths3b)}
Deaths3b = data.frame(Deaths3b)
  # Bi-Daily
Deaths3c=vector()
for(i in 1:450){
  x = 2 * (i-1) + 1
  y = 2 * i
  Deaths3c <- append(Deaths3c, mean(Deaths3a[x:y, 1]))
  Deaths3c = ts(Deaths3c)}
Deaths3c = data.frame(Deaths3c)
  # Tri-Daily
Deaths3d=vector()
for(i in 1:300){
  x = 3 * (i-1) + 1
  y = 3 * i
  Deaths3d <- append(Deaths3d, mean(Deaths3a[x:y, 1]))
  Deaths3d = ts(Deaths3d)}
Deaths3d = data.frame(Deaths3d)
  # Quad-Daily
Deaths3e=vector()
for(i in 1:225){
  x = 4 * (i-1) + 1
  y = 4 * i
  Deaths3e <- append(Deaths3e, mean(Deaths3a[x:y, 1]))
  Deaths3e = ts(Deaths3e)}
Deaths3e = data.frame(Deaths3e)
  # Penta-Daily
Deaths3f=vector()
for(i in 1:180){
  x = 5 * (i-1) + 1
  y = 5 * i
  Deaths3f <- append(Deaths3f, mean(Deaths3a[x:y, 1]))
  Deaths3f = ts(Deaths3f)}
Deaths3f = data.frame(Deaths3f)
  # Sext-Daily
Deaths3g=vector()
for(i in 1:150){
  x = 6 * (i-1) + 1
  y = 6 * i
  Deaths3g <- append(Deaths3g, mean(Deaths3a[x:y, 1]))
  Deaths3g = ts(Deaths3g)}
Deaths3g = data.frame(Deaths3g)


# Mortality: [December 4, 2020 - May 24, 2023]
  # Daily
Mort3a = ts(covid$Mortality[337:1238])
Mort3a= data.frame(Mort3a)
  # Weekly
Mort3b=vector()
for(i in 1:128){
  x = 7 * (i-1) + 1
  y = 7 * i
  Mort3b <- append(Mort3b, mean(Mort3a[x:y, 1]))
  Mort3b = ts(Mort3b)}
Mort3b = data.frame(Mort3b)
  # Bi-Daily
Mort3c=vector()
for(i in 1:450){
  x = 2 * (i-1) + 1
  y = 2 * i
  Mort3c <- append(Mort3c, mean(Mort3a[x:y, 1]))
  Mort3c = ts(Mort3c)}
Mort3c = data.frame(Mort3c)
  # Tri-Daily
Mort3d=vector()
for(i in 1:300){
  x = 3 * (i-1) + 1
  y = 3 * i
  Mort3d <- append(Mort3d, mean(Mort3a[x:y, 1]))
  Mort3d = ts(Mort3d)}
Mort3d = data.frame(Mort3d)
  # Quad-Daily
Mort3e=vector()
for(i in 1:225){
  x = 4 * (i-1) + 1
  y = 4 * i
  Mort3e <- append(Mort3e, mean(Mort3a[x:y, 1]))
  Mort3e = ts(Mort3e)}
Mort3e = data.frame(Mort3e)
  # Penta-Daily
Mort3f=vector()
for(i in 1:180){
  x = 5 * (i-1) + 1
  y = 5 * i
  Mort3f <- append(Mort3f, mean(Mort3a[x:y, 1]))
  Mort3f = ts(Mort3f)}
Mort3f = data.frame(Mort3f)
  # Sext-Daily
Mort3g=vector()
for(i in 1:150){
  x = 6 * (i-1) + 1
  y = 6 * i
  Mort3g <- append(Mort3g, mean(Mort3a[x:y, 1]))
  Mort3g = ts(Mort3g)}
Mort3g = data.frame(Mort3g)


# Vax: [December 4, 2020 - May 24, 2023]
  # Daily
Vax3a = ts(covid$people_vaccinated[337:1238])
Vax3a= data.frame(Vax3a)
  # Weekly
Vax3b=vector()
for(i in 1:128){
  x = 7 * (i-1) + 1
  y = 7 * i
  Vax3b <- append(Vax3b, mean(Vax3a[x:y, 1]))
  Vax3b = ts(Vax3b)}
Vax3b = data.frame(Vax3b)
  # Bi-Daily
Vax3c=vector()
for(i in 1:450){
  x = 2 * (i-1) + 1
  y = 2 * i
  Vax3c <- append(Vax3c, mean(Vax3a[x:y, 1]))
  Vax3c = ts(Vax3c)}
Vax3c = data.frame(Vax3c)
  # Tri-Daily
Vax3d=vector()
for(i in 1:300){
  x = 3 * (i-1) + 1
  y = 3 * i
  Vax3d <- append(Vax3d, mean(Vax3a[x:y, 1]))
  Vax3d = ts(Vax3d)}
Vax3d = data.frame(Vax3d)
  # Quad-Daily
Vax3e=vector()
for(i in 1:225){
  x = 4 * (i-1) + 1
  y = 4 * i
  Vax3e <- append(Vax3e, mean(Vax3a[x:y, 1]))
  Vax3e = ts(Vax3e)}
Vax3e = data.frame(Vax3e)
  # Penta-Daily
Vax3f=vector()
for(i in 1:180){
  x = 5 * (i-1) + 1
  y = 5 * i
  Vax3f <- append(Vax3f, mean(Vax3a[x:y, 1]))
  Vax3f = ts(Vax3f)}
Vax3f = data.frame(Vax3f)
  # Sext-Daily
Vax3g=vector()
for(i in 1:150){
  x = 6 * (i-1) + 1
  y = 6 * i
  Vax3g <- append(Vax3g, mean(Vax3a[x:y, 1]))
  Vax3g = ts(Vax3g)}
Vax3g = data.frame(Vax3g)


vect = vector()
vect = append(vect, Cases1a)
vect = append(vect, Cases1b)
vect = append(vect, Cases1c)
vect = append(vect, Cases1d)
vect = append(vect, Cases1e)
vect = append(vect, Cases1f)
vect = append(vect, Cases1g)
vect = append(vect, Deaths1a)
vect = append(vect, Deaths1b)
vect = append(vect, Deaths1c)
vect = append(vect, Deaths1d)
vect = append(vect, Deaths1e)
vect = append(vect, Deaths1f)
vect = append(vect, Deaths1g)
vect = append(vect, Mort1a)
vect = append(vect, Mort1b)
vect = append(vect, Mort1c)
vect = append(vect, Mort1d)
vect = append(vect, Mort1e)
vect = append(vect, Mort1f)
vect = append(vect, Mort1g)
vect = append(vect, Cases2a)
vect = append(vect, Cases2b)
vect = append(vect, Cases2c)
vect = append(vect, Cases2d)
vect = append(vect, Cases2e)
vect = append(vect, Cases2f)
vect = append(vect, Deaths2a)
vect = append(vect, Deaths2b)
vect = append(vect, Deaths2c)
vect = append(vect, Deaths2d)
vect = append(vect, Deaths2e)
vect = append(vect, Deaths2f)
vect = append(vect, Mort2a)
vect = append(vect, Mort2b)
vect = append(vect, Mort2c)
vect = append(vect, Mort2d)
vect = append(vect, Mort2e)
vect = append(vect, Mort2f)
vect = append(vect, Cases2_5a)
vect = append(vect, Cases2_5b)
vect = append(vect, Cases2_5c)
vect = append(vect, Cases2_5d)
vect = append(vect, Cases2_5e)
vect = append(vect, Cases2_5f)
vect = append(vect, Cases2_5g)
vect = append(vect, Deaths2_5a)
vect = append(vect, Deaths2_5b)
vect = append(vect, Deaths2_5c)
vect = append(vect, Deaths2_5d)
vect = append(vect, Deaths2_5e)
vect = append(vect, Deaths2_5f)
vect = append(vect, Deaths2_5g)
vect = append(vect, Mort2_5a)
vect = append(vect, Mort2_5b)
vect = append(vect, Mort2_5c)
vect = append(vect, Mort2_5d)
vect = append(vect, Mort2_5e)
vect = append(vect, Mort2_5f)
vect = append(vect, Mort2_5g)
vect = append(vect, Cases3a)
vect = append(vect, Cases3b)
vect = append(vect, Cases3c)
vect = append(vect, Cases3d)
vect = append(vect, Cases3e)
vect = append(vect, Cases3f)
vect = append(vect, Cases3g)
vect = append(vect, Deaths3a)
vect = append(vect, Deaths3b)
vect = append(vect, Deaths3c)
vect = append(vect, Deaths3d)
vect = append(vect, Deaths3e)
vect = append(vect, Deaths3f)
vect = append(vect, Deaths3g)
vect = append(vect, Mort3a)
vect = append(vect, Mort3b)
vect = append(vect, Mort3c)
vect = append(vect, Mort3d)
vect = append(vect, Mort3e)
vect = append(vect, Mort3f)
vect = append(vect, Mort3g)
vect = append(vect, Vax3a)
vect = append(vect, Vax3b)
vect = append(vect, Vax3c)
vect = append(vect, Vax3d)
vect = append(vect, Vax3e)
vect = append(vect, Vax3f)
vect = append(vect, Vax3g)

vect1 = vector()
vect1 = append(vect1, "Cases1a")
vect1 = append(vect1, "Cases1b")
vect1 = append(vect1, "Cases1c")
vect1 = append(vect1, "Cases1d")
vect1 = append(vect1, "Cases1e")
vect1 = append(vect1, "Cases1f")
vect1 = append(vect1, "Cases1g")
vect1 = append(vect1, "Deaths1a")
vect1 = append(vect1, "Deaths1b")
vect1 = append(vect1, "Deaths1c")
vect1 = append(vect1, "Deaths1d")
vect1 = append(vect1, "Deaths1e")
vect1 = append(vect1, "Deaths1f")
vect1 = append(vect1, "Deaths1g")
vect1 = append(vect1, "Mort1a")
vect1 = append(vect1, "Mort1b")
vect1 = append(vect1, "Mort1c")
vect1 = append(vect1, "Mort1d")
vect1 = append(vect1, "Mort1e")
vect1 = append(vect1, "Mort1f")
vect1 = append(vect1, "Mort1g")
vect1 = append(vect1, "Cases2a")
vect1 = append(vect1, "Cases2b")
vect1 = append(vect1, "Cases2c")
vect1 = append(vect1, "Cases2d")
vect1 = append(vect1, "Cases2e")
vect1 = append(vect1, "Cases2f")
vect1 = append(vect1, "Deaths2a")
vect1 = append(vect1, "Deaths2b")
vect1 = append(vect1, "Deaths2c")
vect1 = append(vect1, "Deaths2d")
vect1 = append(vect1, "Deaths2e")
vect1 = append(vect1, "Deaths2f")
vect1 = append(vect1, "Mort2a")
vect1 = append(vect1, "Mort2b")
vect1 = append(vect1, "Mort2c")
vect1 = append(vect1, "Mort2d")
vect1 = append(vect1, "Mort2e")
vect1 = append(vect1, "Mort2f")
vect1 = append(vect1, "Case2_5a")
vect1 = append(vect1, "Case2_5b")
vect1 = append(vect1, "Case2_5c")
vect1 = append(vect1, "Case2_5d")
vect1 = append(vect1, "Case2_5e")
vect1 = append(vect1, "Case2_5f")
vect1 = append(vect1, "Case2_5g")
vect1 = append(vect1, "Death2_5a")
vect1 = append(vect1, "Death2_5b")
vect1 = append(vect1, "Death2_5c")
vect1 = append(vect1, "Death2_5d")
vect1 = append(vect1, "Death2_5e")
vect1 = append(vect1, "Death2_5f")
vect1 = append(vect1, "Death2_5g")
vect1 = append(vect1, "Mort2_5a")
vect1 = append(vect1, "Mort2_5b")
vect1 = append(vect1, "Mort2_5c")
vect1 = append(vect1, "Mort2_5d")
vect1 = append(vect1, "Mort2_5e")
vect1 = append(vect1, "Mort2_5f")
vect1 = append(vect1, "Mort2_5g")
vect1 = append(vect1, "Cases3a")
vect1 = append(vect1, "Cases3b")
vect1 = append(vect1, "Cases3c")
vect1 = append(vect1, "Cases3d")
vect1 = append(vect1, "Cases3e")
vect1 = append(vect1, "Cases3f")
vect1 = append(vect1, "Cases3g")
vect1 = append(vect1, "Deaths3a")
vect1 = append(vect1, "Deaths3b")
vect1 = append(vect1, "Deaths3c")
vect1 = append(vect1, "Deaths3d")
vect1 = append(vect1, "Deaths3e")
vect1 = append(vect1, "Deaths3f")
vect1 = append(vect1, "Deaths3g")
vect1 = append(vect1, "Mort3a")
vect1 = append(vect1, "Mort3b")
vect1 = append(vect1, "Mort3c")
vect1 = append(vect1, "Mort3d")
vect1 = append(vect1, "Mort3e")
vect1 = append(vect1, "Mort3f")
vect1 = append(vect1, "Mort3g")
vect1 = append(vect1, "Vax3a")
vect1 = append(vect1, "Vax3b")
vect1 = append(vect1, "Vax3c")
vect1 = append(vect1, "Vax3d")
vect1 = append(vect1, "Vax3e")
vect1 = append(vect1, "Vax3f")
vect1 = append(vect1, "Vax3g")
```
\

# V3
```{r, warning = FALSE}

# We will create 3 transformations of each model:
#   - Box-Cox Transformation
#   - Log Transformation
#   - Square Root Transformation

`_` = list()
bc = list()
log = list()
sqrt = list()
Data_aa <- data.frame(matrix(ncol=24, nrow=2112))
colnames(Data_aa) <- c("Name", "Pass", "Dataset", "Average", "Transformation", 
                      "Differencing", "Anderson-Darling Test", "Shapiro test",
                      "Augmented Dickey-Fuller Test", "KPSS Test", "Box-Pierce Test",
                      "Ljung-Box Test", "McLeod-Li Test", "Grandparent_Variance",
                      "Parent_Variance", "Nonseasonal_Variance", "Seasonal_Variance",
                      "Variance", "Variance_test", "AICc", "Residual_Tests",
                      "Normality_Tests", "Stationarity_Tests", "X")

# For tests, reject if p < 0.05
ad_test_a = list()    # H_0 = data is normally distributed (do not want to reject)
shapiro_test_a = list()   # H_0 = data is normal (do not want to reject)
kpss_test_a = list()    # H_0 = data is stationary (do not want to reject)
adf_test_a = list()       # H_0 = data contains a unit root and are non stationary (want to reject)
Box_Pierce_test_a = list()  # H_0 = data are white noise (do not want to reject)
Ljung_Box_test_a = list()   # H_0 = Residuals are not autocorrelated / the data are independently distributed (do not want to reject)
McLeod_Li_test_a = list()   # H_0 = Independence of residuals (do not want to reject)

# Rejecting a test has a greater significance than not rejecting a test. This is because rejection proves that the null hypothesis cannot be true while not rejecting implies that nothing was found that proves the null hypothesis false. Just because a test doesn't have a reason to reject the null hypothesis does not mean that there exists no reason to reject it. It only means that particular test could not prove the null hypothesis false. A similar test for the same null or alternative hypothesis can have a different result. The test that rejects its null hypothesis is therefore given more weight to its validity.

# Since the kpss.test and adf.test have opposing null hypotheses for the stationarity of a time series, we will put more double weight on the adf.test being rejected when calculating the amount of tests that give a favorable result.
transformation_name2 = vector()
Difference2 = vector()
x = 1
for(i in 1:length(vect)){
  bcTransform <- boxcox(vect[[1]]~ as.numeric(1:length(vect[[1]])))       # plot the graph
  plot(bcTransform)
  bcTransform$x[which(bcTransform$y == max(bcTransform$y))] # gives the value of λ
  lambda=bcTransform$x[which(bcTransform$y == max(bcTransform$y))]
  title(main = paste0(vect1[1], "  lambda = ", round(lambda, 3)))
  
  # Perform transformations, plot transformed data, histograms:
  transform = vector()
  transform = append(transform, data.frame(vect[[1]]))
  transform = append(transform, data.frame((1/lambda)*(vect[[i]]^lambda-1)))
  transform = append(transform, data.frame(log(vect[[i]])))
  transform = append(transform, data.frame(sqrt(vect[[i]])))
  
  transform_name = vector()
  transform_name = append(transform_name, paste0(vect1[i], "1"))
  `_` = append(`_`, vect1[i])
  transform_name = append(transform_name, paste0(vect1[i], ".bc1"))
  bc = append(bc, paste0(vect1[i], ".bc1"))
  transform_name = append(transform_name, paste0(vect1[i], ".log1"))
  log = append(log, paste0(vect1[i], ".log1"))
  transform_name = append(transform_name, paste0(vect1[i], ".sqrt1"))
  sqrt = append(sqrt, paste0(vect1[i], ".sqrt1"))
  
  transformation_name2 = append(transformation_name2, transform_name)
  
# For each of the 3 transformations and the original for each data set, 
# we will test the goodness of fit when each time series is differenced at: 
#   - Lag 0 (no differencing) 
#   - Lag 1 (non seasonal difference - yearly)
#   - Lag 7 (seasonal difference - weekly) 
#   - Lag 12 (seasonal difference - monthly) 
#   - Lag 1.7 (non seasonal difference - yearly & seasonal difference - weekly) 
#   - Lag 1.12 (non seasonal difference - yearly & seasonal difference - monthly) 

# This bring the total number of models being evaluated to 480.
  
  list = c(0,1,7,12,1.7,1.12)
  for(j in 1:length(transform)){
    difference = vector()
    diff_name = vector()
    for(k in 1:length(list)){
      Data_aa$X[x] = x
      Data_aa$Grandparent_Variance[x] = signif(var(vect[[i]]), 4)
      Data_aa$Parent_Variance[x] = signif(var(transform[[j]]), 4)
      Data_aa$Dataset[x] = vect1[i]
      if(transform_name[j] %in% `_`){
        Data_aa$Transformation[x] = "none"}
      if(transform_name[j] %in% bc){
        Data_aa$Transformation[x] = "Box-Cox"}
      if(transform_name[j] %in% log){
        Data_aa$Transformation[x] = "Log"}
      if(transform_name[j] %in% sqrt){
        Data_aa$Transformation[x] = "Square Root"}
      if(i %in% c(1,8,15,22,28,34,40,47,54,61,68,75,82)){
        Data_aa$Average[x] = "Daily"}
      if(i %in% c(2,9,16,23,29,35,41,48,55,62,69,76,83)){
        Data_aa$Average[x] = "Weekly"}
      if(i %in% c(3,10,17,24,30,36,42,49,56,63,70,77,84)){
        Data_aa$Average[x] = "Bi-Daily"}
      if(i %in% c(4,11,18,25,31,37,43,50,57,64,71,78,85)){
        Data_aa$Average[x] = "Tri-Daily"}
      if(i %in% c(5,12,19,26,32,38,44,51,58,65,72,79,86)){
        Data_aa$Average[x] = "Quad-Daily"}
      if(i %in% c(6,13,20,27,33,39,45,52,59,66,73,80,87)){
        Data_aa$Average[x] = "Penta-Daily"}
      if(i %in% c(7,14,21,28,34,40,46,53,60,67,74,81,88)){
        Data_aa$Average[x] = "Sext-Daily"}
      
      ok = list[k]
      while(Data_aa$Stationarity[x] != "Pass" & Data_aa$Stationarity[x] != "Nonstationary"){
        if(ok==0){
          Data_aa[x, 9] = round(adf.test(transform[[j]])$p.value, digits=5)
          Data_aa[x, 10] = round(kpss.test(transform[[j]])$p.value, digits=5)
          if(Data_aa[x,9] <= 0.05){
            Data_aa$Stationarity_Tests[x] = "Pass"}
          if(Data_aa[x,9] > 0.05 & Data_aa[x,10] >= 0.05){
            Data_aa$Stationarity_Tests[x] = "Pass"}
          else{
            Data_aa$Stationarity_Tests[x] = "Fail"}
          if(Data_aa$Stationarity_Tests[x] == "Pass"){
            diff_name = append(diff_name, paste0(transform_name[j]))
            Data_aa[x,1] = diff_name[k]
            Data_aa$Differencing[x] = "None"
            arima = try(arima(transform[[j]], order = c(0,0,0), method = "ML"))
            difference = append(difference, data.frame(transform[[j]]))
            Data_aa$AICc[x] = try(AICc(arima))
            Data_aa$Variance[x] = Data_aa$Parent_Variance[x]
            Data_aa$Nonseasonal_Variance[x] = Data_aa$Variance[x]
            Data_aa$Seasonal_Variance[x] = Data_aa$Variance[x]}}
        else{
          if(ok != floor(ok)){
            num = 100*(ok-floor(ok))
            if(num%%7==0){
              num = 7}
            diff1 = diff(transform[[j]], lag = floor(ok))
            diff = diff(diff1, lag = num)}
          else{
            num=0
            diff = diff(transform[[j]], lag = ok)}
          Data_aa[x, 9] = round(adf.test(diff)$p.value, digits=5)
          Data_aa[x, 10] = round(kpss.test(diff)$p.value, digits=5)
          if(Data_aa[x,9] <= 0.05){
            Data_aa$Stationarity_Tests[x] = "Pass"}
          if(Data_aa[x,9] > 0.05 & Data_aa[x,10] >= 0.05){
            Data_aa$Stationarity_Tests[x] = "Pass"}
          else{
            Data_aa$Stationarity_Tests[x] = "Fail"}
          if(Data_aa$Stationarity_Tests[x] = "Fail" & 
             ((ok %in% c(6, 7, 12)) | (floor(ok)==6 & num==12) | (floor(ok)==4 & num==7))){
            Data_aa$Stationarity_Tests[x] = "Nonstationary"}
          if(Data_aa$Stationarity_Tests[x] == "Pass" | Data_aa$Stationarity_Tests[x] == "Nonstationary"){
            arima = try(arima(diff, order = c(0,0,0), method="ML"))
            Data_aa$AICc[x] = try(AICc(arima))
            difference = append(diference, data.frame(diff))
            Data_aa$Variance[x] = signif(var(diff), 4)
            if(ok != floor(ok)){
              diff_name = append(diff_name, paste0(transform_name[j], "(", floor(ok), ".", num, ")"))
              Data_aa$Differencing[x] = paste0("Lag = ", floor(ok), ", & Lag = ", num)
              Data_aa$Nonseasonal_Variance[x] = signif(var(diff1), 4)
              Data_aa$Seasonal_Variance[x] = Data_aa$Variance[x-2]}
            if(ok == floor(ok)){
              diff_name = append(diff_name, paste0(transform_name[j], "(", ok, ")"))
              Data_aa$Differencing[x] = paste0("Lag = ", ok)
              Data_aa$Nonseasonal_Variance[x] = Data_aa$Variance[x]
              Data_aa$Seasonal_Variance[x] = Data_aa$Variance[x]}
            Data_aa[x,1] = diff_name[k]
            if(num == 12){
              Difference2 = append(Difference2, difference)}}}
          ok = ok + 1}
      
      
      Data_aa[x, 7] = round(ad.test(difference[[k]])$p.value, digits=5)
      
      Data_aa[x, 8] = round(shapiro.test(difference[[k]])$p.value, digits=5)
      
      Data_aa[x, 11] = round(Box.test(difference[[k]], lag=sqrt(length(
        difference[[k]])), type=c("Box-Pierce"), fitdf = 0)$p.value, digits=5)
      
      Data_aa[x, 12] = round(Box.test(difference[[k]], lag=sqrt(length(
        difference[[k]])), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=5)
      
      Data_aa[x, 13] = round(Box.test((difference[[k]])^2, lag=sqrt(length(
        difference[[k]])), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=5)
      
      Data_aa$Pass[x]=0
      if(Data_a[x,7]>=0.05 | Data_a[x,8]>=0.05){
        Data_a$Pass[x] = 1 + Data_a$Pass[x]}
      if(Data_a[x, 9] <= 0.05 | Data_a[x,10]>=0.05){
        Data_a$Pass[x] = 1 + Data_a$Pass[x]}
      for(z in 11:13){
        if(Data_a[x,z] >= 0.05){
          Data_a$Pass = 1 + Data_a$Pass}}
      Variance_Order = data.frame(matrix(ncol=3, nrow=5))
      colnames(Variance_Order) = c("Levels", "Variance", "Rank")
      Variance_Order$Levels = c("Original", "Transformation", "Differencing", 
                                "Seasonality", "Current")
      Variance_Order$Variance[1:5] = Data_aa[x, c(14:18)]
      Variance_Order$Variance = as.double(Variance_Order$Variance)
      Variance_Order$Rank = as.integer(rank(Variance_Order$Variance, ties.method = "min"))
      Data_aa$Variance_test[x] = paste0(
        Variance_Order$Rank[1], ", ", Variance_Order$Rank[2],
        ", ", Variance_Order$Rank[3], ", ", Variance_Order$Rank[4], ", ", 
        Variance_Order$Rank[5])
      Fails = 0
      if(Data_aa[x, 14] < Data_aa[x, 15]){
        Fails=Fails+1}
      if((Data_aa[x, 15] < Data_aa[x, 16]) & (Data_aa[x, 15] < Data_aa[x, 17])){
        Fails=Fails+1}
      if((Data_aa[x, 14] < Data_aa[x, 16]) & (Data_aa[x, 14] < Data_aa[x, 17])){
        Fails=Fails+1}
      if((Data_aa[x, 16] < Data_aa[x, 18]) & (Data_aa[x, 17] < Data_aa[x, 18])){
        Fails=Fails+1}
      if(Data_aa[x, 14] < Data_aa[x, 18]){
        Fails=Fails+1}
      if(Data_aa[x, 15] < Data_aa[x, 18]){
        Fails=Fails+1}
      Data_aa$Pass[x] = (6-Fails)/6 + Data_aa$Pass[x]
      
      Pass1 = 0 
      for(s in 11:13){
        if(Data_aa[x,s] >= 0.05){
          Pass1 = Pass1 + 1}}
      if(Pass1 >= 3){
        Data_aa$Residual_Tests[x] = "Pass3"}
      if(Pass1 > 1 & Pass1 < 3){
        Data_aa$Residual_Tests[x] = "Pass2"}
      if(Pass1 > 0 & Pass1 < 2){
        Data_aa$Residual_Tests[x] = "Pass1"}
      if(Pass1 == 0){
        Data_aa$Residual_Tests[x] = "Fail"}
      Pass2 = 0
      if(Data_aa[x,7] >= 0.05){
        Pass2 = Pass2 + 1}
      if(Data_aa[x,8] >= 0.05){
        Pass2 = Pass2 + 1}
      if(Pass2 >= 1){
        Data_aa$Normality_Tests[x] = "Pass"}
      else{
        Data_aa$Normality_Tests[x] = "Fail"}
      x = x + 1}}}

Dict2 = dict(init_keys = NULL, init_values = NULL)
for(i in 1:2112){
  Dict1[Data_aa$Name[i]] = Difference2[[i]]}


Data_aa1 = subset(Data_aa, Data_aa$Pass >= 4)
Data_aa1

Stationarity_aa = subset(Data_aa, Data_aa$Stationarity_Tests == "Pass")
Stationarity_aa
Normality_aa = subset(Data_aa, Data_aa$Normality_Tests == "Pass")
Normality_aa
Residuals_aa = subset(Data_aa, Data_aa$Residual_Tests != "Fail")
Residuals_aa


Stat_Norm_aa = subset(Stationarity_aa, Stationarity_aa$Normality_Tests == "Pass")
Stat_Norm_Pass_aa = subset(Stat_Norm_aa, Stat_Norm_aa$Pass >=4)
Stat_Res_aa = subset(Stationarity_aa, Stationarity_aa$Residual_Tests != "Fail")
Stat_Res_Pass_aa = subset(Stat_Res_aa, Stat_Res_aa$Pass >=4)
Stat_Res_Norm_aa = subset(Stat_Res_aa, Stat_Res_aa$Normality_Tests == "Pass")
Res_Norm_aa = subset(Residuals_aa, Residuals_aa$Normality_Tests == "Pass")
```



# Transformation, Differencing, Normality Tests, and Stationarity Tests
# V2
```{r, warning = FALSE}

# We will create 3 transformations of each model:
#   - Box-Cox Transformation
#   - Log Transformation
#   - Square Root Transformation

`_` = list()
bc = list()
log = list()
sqrt = list()
Data_a <- data.frame(matrix(ncol=19, nrow=2112))
colnames(Data_a) <- c("Name", "Pass", "Dataset", "Average", "Transformation", 
                      "Differencing", "Anderson-Darling Test", "Shapiro test",
                      "Augmented Dickey-Fuller Test", "KPSS Test", "Box-Pierce Test",
                      "Ljung-Box Test", "McLeod-Li Test", "Variance_test", "AICc", "Residual_Tests",
                      "Normality_Tests", "Stationarity_Tests", "X")

# For tests, reject if p < 0.05
# ad_test_a = list()    H_0 = data is normally distributed (do not want to reject)
# shapiro_test_a = list()    H_0 = data is normal (do not want to reject)
# kpss_test_a = list()    H_0 = data is stationary (do not want to reject)
# adf_test_a = list()       H_0 = data contains a unit root and are non stationary (want to reject)
# Box_Pierce_test_a = list()   H_0 = data are white noise (do not want to reject)
# Ljung_Box_test_a = list()    H_0 = Residuals are not autocorrelated / the data are independently distributed (do not want to reject)
# McLeod_Li_test_a = list()    H_0 = Independence of residuals (do not want to reject)

# Rejecting a test has a greater significance than not rejecting a test. This is because rejection proves that the null hypothesis cannot be true while not rejecting implies that nothing was found that proves the null hypothesis false. Just because a test doesn't have a reason to reject the null hypothesis does not mean that there exists no reason to reject it. It only means that particular test could not prove the null hypothesis false. A similar test for the same null or alternative hypothesis can have a different result. The test that rejects its null hypothesis is therefore given more weight to its validity.

# Since the kpss.test and adf.test have opposing null hypotheses for the stationarity of a time series, we will put more double weight on the adf.test being rejected when calculating the amount of tests that give a favorable result.
transformation_name1 = vector()
Difference1 = vector()

x = 1
for(i in 1:length(vect)){
  bcTransform <- boxcox(vect[[i]]~ as.numeric(1:length(vect[[i]])))       # plot the graph

  bcTransform$x[which(bcTransform$y == max(bcTransform$y))] # gives the value of λ
  lambda=bcTransform$x[which(bcTransform$y == max(bcTransform$y))]
  title(main = paste0(vect1[i], "  lambda = ", round(lambda, 3)))
  
  # Perform transformations, plot transformed data, histograms:
  transform = vector()
  transform = append(transform, data.frame(vect[[i]]))
  transform = append(transform, data.frame((1/lambda)*(vect[[i]]^lambda-1)))
  transform = append(transform, data.frame(log(vect[[i]])))
  transform = append(transform, data.frame(sqrt(vect[[i]])))

  transform_name = vector()
  transform_name = append(transform_name, paste0(vect1[i]))
  `_` = append(`_`, vect1[i])
  transform_name = append(transform_name, paste0(vect1[i], ".bc"))
  bc = append(bc, paste0(vect1[i], ".bc"))
  transform_name = append(transform_name, paste0(vect1[i], ".log"))
  log = append(log, paste0(vect1[i], ".log"))
  transform_name = append(transform_name, paste0(vect1[i], ".sqrt"))
  sqrt = append(sqrt, paste0(vect1[i], ".sqrt"))
  
  transformation_name1 = append(transformation_name1, transform_name)
  
# For each of the 3 transformations and the original for each data set, 
# we will test the goodness of fit when each time series is differenced at: 
#   - Lag 0 (no differencing) 
#   - Lag 1 (non seasonal difference - yearly)
#   - Lag 7 (seasonal difference - weekly) 
#   - Lag 12 (seasonal difference - monthly) 
#   - Lag 1.7 (non seasonal difference - yearly & seasonal difference - weekly) 
#   - Lag 1.12 (non seasonal difference - yearly & seasonal difference - monthly) 

# This bring the total number of models being evaluated to 480.
  
  list = c(0,1,7,12,1.7,1.12)
  for(j in 1:length(transform)){
    difference = vector()
    diff_name = vector()
    for(k in 1:length(list)){
      Data_a$X[x] = x
      Grandparent_Variance = signif(var(vect[[i]]), 4)
      Parent_Variance = signif(var(transform[[j]]), 4)
      Data_a$Dataset[x] = vect1[i]
      if(transform_name[j] %in% `_`){
        Data_a$Transformation[x] = "none"}
      if(transform_name[j] %in% bc){
        Data_a$Transformation[x] = "Box-Cox"}
      if(transform_name[j] %in% log){
        Data_a$Transformation[x] = "Log"}
      if(transform_name[j] %in% sqrt){
        Data_a$Transformation[x] = "Square Root"}
      if(i %in% c(1,8,15,22,28,34,40,47,54,61,68,75,82)){
        Data_a$Average[x] = "Daily"}
      if(i %in% c(2,9,16,23,29,35,41,48,55,62,69,76,83)){
        Data_a$Average[x] = "Weekly"}
      if(i %in% c(3,10,17,24,30,36,42,49,56,63,70,77,84)){
        Data_a$Average[x] = "Bi-Daily"}
      if(i %in% c(4,11,18,25,31,37,43,50,57,64,71,78,85)){
        Data_a$Average[x] = "Tri-Daily"}
      if(i %in% c(5,12,19,26,32,38,44,51,58,65,72,79,86)){
        Data_a$Average[x] = "Quad-Daily"}
      if(i %in% c(6,13,20,27,33,39,45,52,59,66,73,80,87)){
        Data_a$Average[x] = "Penta-Daily"}
      if(i %in% c(7,14,21,28,34,40,46,53,60,67,74,81,88)){
        Data_a$Average[x] = "Sext-Daily"}
      
      diff_name = append(diff_name, paste0(transform_name[j], "(", list[k], ")"))

      if(list[k]==0){
        Data_a[x,1] = diff_name[k]
        Data_a$Differencing[x] = "Lag = none"
        diff = try(arima(transform[[j]], order = c(0,0,0), method = "ML"))
        difference = append(difference, data.frame(transform[[j]]))
        Data_a$AICc[x] = try(AICc(diff))
        Variance = Parent_Variance
        Nonseasonal_Variance = Variance
        Seasonal_Variance = Variance}
      if(list[k]==1 | list[k]==7 | list[k]==12){
        Data_a[x,1] = paste0(transform_name[j], "(", list[k], ")")
        diff = diff(transform[[j]], lag = list[k])
        difference = append(difference, data.frame(diff))
        res = try(arima(diff, order = c(0,0,0), method="ML"))
        Data_a$AICc[x] = try(AICc(res), silent = TRUE)
        Data_a$Differencing[x] = paste0("Lag = ", list[k])
        Variance = signif(var(diff), 4)
        Nonseasonal_Variance = Variance
        Seasonal_Variance = Variance}
      if(list[k]==1.7 | list[k]==1.12){
        Data_a[x,1] = paste0(transform_name[j], "(", list[k], ")")
        diff1 = diff(transform[[j]], lag = 1)
        diff = diff(diff1, lag = list[k-2])
        difference = append(difference, data.frame(diff))
        res = try(arima(diff, order = c(0,0,0), method="ML"))
        Data_a$AICc[x] = try(AICc(res), silent = TRUE)
        Data_a$Differencing[x] = paste0("Lag = 1 & Lag = ", list[k-2])
        Variance[x] = signif(var(diff),4)
        Num = 100*(list[k] - floor(list[k]))
        if(Num%%7 == 0){
          Num=7}
        Seasonal_Variance = signif(var(diff(transform[[j]], lag=Num)), 4)
        Nonseasonal_Variance = signif(var(diff1), 4)}
      if(list[k]==1.12){
        Difference1 = append(Difference1, difference)}
      
      Data_a[x, 7] = round(ad.test(difference[[k]])$p.value, digits=5)
      
      Data_a[x, 8] = round(shapiro.test(difference[[k]])$p.value, digits=5)
      
      Data_a[x, 9] = round(adf.test(difference[[k]])$p.value, digits=5)
      
      Data_a[x, 10] = round(kpss.test(difference[[k]])$p.value, digits=5)
      
      Data_a[x, 11] = round(Box.test(difference[[k]], lag=sqrt(length(
        difference[[k]])), type=c("Box-Pierce"), fitdf = 0)$p.value, digits=5)
      
      Data_a[x, 12] = round(Box.test(difference[[k]], lag=sqrt(length(
        difference[[k]])), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=5)
      
      Data_a[x, 13] = round(Box.test((difference[[k]])^2, lag=sqrt(length(
        difference[[k]])), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=5)
      
      Data_a$Pass[x]=0
      
      if(Data_a[x,7]>=0.05 | Data_a[x,8]>=0.05){
        Data_a$Normality_Tests[x] = "Pass"
        Data_a$Pass[x] = 1 + Data_a$Pass[x]}
      else{
        Data_a$Normality_Tests[x] = "Fail"}
      if(Data_a[x, 9] <= 0.05 | Data_a[x,10]>=0.05){
        Data_a$Stationarity_Tests[x] = "Pass"
        Data_a$Pass[x] = 1 + Data_a$Pass[x]}
      else{
        Data_a$Stationarity_Tests[x] = "Fail"}
      for(z in 11:13){
        if(Data_a[x,z] >= 0.05){
          Data_a$Pass[x] = 1 + Data_a$Pass[x]}}
      Variance_Order = data.frame(matrix(ncol=3, nrow=5))
      colnames(Variance_Order) = c("Levels", "Variance", "Rank")
      Variance_Order$Levels = c("Original", "Transformation", "Differencing", 
                                "Seasonality", "Current")
      Variance_Order$Variance[1:5] = c(Grandparent_Variance, Parent_Variance, 
                                       Nonseasonal_Variance, Seasonal_Variance, Variance)
      Variance_Order$Variance = as.double(Variance_Order$Variance)
      Variance_Order$Rank = as.integer(rank(Variance_Order$Variance, ties.method = "min"))
      Data_a$Variance_test[x] = paste0(
        Variance_Order$Rank[1], ", ", Variance_Order$Rank[2],
        ", ", Variance_Order$Rank[3], ", ", Variance_Order$Rank[4], ", ", 
        Variance_Order$Rank[5])
    
      Pass1 = 0 
      for(s in 11:13){
        if(Data_a[x,s] >= 0.05){
          Pass1 = Pass1 + 1}}
      if(Pass1 >= 3){
        Data_a$Residual_Tests[x] = "Pass3"}
      if(Pass1 > 1 & Pass1 < 3){
        Data_a$Residual_Tests[x] = "Pass2"}
      if(Pass1 > 0 & Pass1 < 2){
        Data_a$Residual_Tests[x] = "Pass1"}
      if(Pass1 == 0){
        Data_a$Residual_Tests[x] = "Fail"}
      x = x + 1}}}

Dict1 = dict(init_keys = NULL, init_values = NULL)
for(i in 1:2112){
  Dict1[Data_a$Name[i]] = Difference1[[i]]}

Data_a1 = subset(Data_a, Data_a$Pass >= 3)
Data_a1

Stationarity_a = subset(Data_a, Data_a$Stationarity_Tests == "Pass")
Stationarity_a
Normality_a = subset(Data_a, Data_a$Normality_Tests == "Pass")
Normality_a
Residuals_a = subset(Data_a, Data_a$Residual_Tests != "Fail")
Residuals_a


Stat_Norm_a = subset(Stationarity_a, Stationarity_a$Normality_Tests == "Pass")
Stat_Norm_Pass_a = subset(Stat_Norm_a, Stat_Norm_a$Pass >=3)
Stat_Res_a = subset(Stationarity_a, Stationarity_a$Residual_Tests != "Fail")
Stat_Res_Pass_a = subset(Stat_Res_a, Stat_Res_a$Pass >=3)
Stat_Res_Norm_a = subset(Stat_Res_a, Stat_Res_a$Normality_Tests == "Pass")
Res_Norm_a = subset(Residuals_a, Residuals_a$Normality_Tests == "Pass")
```

# Transformation, Differencing, Normality Tests, and Stationarity Tests
# V1
```{r, warning = FALSE}

# We will create 3 transformations of each model:
#   - Box-Cox Transformation
#   - Log Transformation
#   - Square Root Transformation

`_` = list()
bc = list()
log = list()
sqrt = list()
Data <- data.frame(matrix(ncol=24, nrow=2112))
colnames(Data) <- c("Name", "Pass", "Dataset", "Average", "Transformation", 
                    "Differencing", "Anderson-Darling Test", "Shapiro test",
                    "Augmented Dickey-Fuller Test", "KPSS Test", "Box-Pierce Test",
                    "Ljung-Box Test", "McLeod-Li Test", "Grandparent_Variance",
                    "Parent_Variance", "Nonseasonal_Variance", "Seasonal_Variance",
                    "Variance", "Variance_test", "AICc", "Residual_Tests",
                    "Normality_Tests", "Stationarity_Tests", "X")

# For tests, reject if p < 0.05
ad_test = list()    # H_0 = data is normally distributed (do not want to reject)
shapiro_test = list()   # H_0 = data is normal (do not want to reject)
kpss_test = list()    # H_0 = data is stationary (do not want to reject)
adf_test = list()       # H_0 = data contains a unit root and are non stationary (want to reject)
Box_Pierce_test = list()  # H_0 = data are white noise (do not want to reject)
Ljung_Box_test = list()   # H_0 = Residuals are not autocorrelated / the data are independently distributed (do not want to reject)
McLeod_Li_test = list()   # H_0 = Independence of residuals (do not want to reject)

# Rejecting a test has a greater significance than not rejecting a test. This is because rejection proves that the null hypothesis cannot be true while not rejecting implies that nothing was found that proves the null hypothesis false. Just because a test doesn't have a reason to reject the null hypothesis does not mean that there exists no reason to reject it. It only means that particular test could not prove the null hypothesis false. A similar test for the same null or alternative hypothesis can have a different result. The test that rejects its null hypothesis is therefore given more weight to its validity.

# Since the kpss.test and adf.test have opposing null hypotheses for the stationarity of a time series, we will put more double weight on the adf.test being rejected when calulating the amount of tests that give a favorable result.
transformation_name = vector()
Best_Models = list()
Best_Models1 = list()
Difference = vector()
x = 1
for(i in 1:length(vect)){
  bcTransform <- boxcox(vect[[i]]~ as.numeric(1:length(vect[[i]])))       # plot the graph

  bcTransform$x[which(bcTransform$y == max(bcTransform$y))] # gives the value of λ
  lambda=bcTransform$x[which(bcTransform$y == max(bcTransform$y))]
  title(main = paste0(vect1[i], "  lambda = ", round(lambda, 3)))
  
  # Perform transformations, plot transformed data, histograms:
  transform = vector()
  transform = append(transform, data.frame(vect[[i]]))
  transform = append(transform, data.frame((1/lambda)*(vect[[i]]^lambda-1)))
  transform = append(transform, data.frame(log(vect[[i]])))
  transform = append(transform, data.frame(sqrt(vect[[i]])))

  transform_name = vector()
  transform_name = append(transform_name, vect1[i])
  `_` = append(`_`, vect1[i])
  transform_name = append(transform_name, paste0(vect1[i], ".bc"))
  bc = append(bc, paste0(vect1[i], ".bc"))
  transform_name = append(transform_name, paste0(vect1[i], ".log"))
  log = append(log, paste0(vect1[i], ".log"))
  transform_name = append(transform_name, paste0(vect1[i], ".sqrt"))
  sqrt = append(sqrt, paste0(vect1[i], ".sqrt"))
  
  transformation_name = append(transformation_name, transform_name)
  
# For each of the 3 transformations and the original for each data set, 
# we will test the goodness of fit when each time series is differenced at: 
#   - Lag 0 (no differencing) 
#   - Lag 1 (non seasonal difference - yearly)
#   - Lag 7 (seasonal difference - weekly) 
#   - Lag 12 (seasonal difference - monthly) 
#   - Lag 1.7 (non seasonal difference - yearly & seasonal difference - weekly) 
#   - Lag 1.12 (non seasonal difference - yearly & seasonal difference - monthly) 

# This bring the total number of models being evaluated to 480.
  
  list = c(0,1,7,12,1.7,1.12)
  for(j in 1:length(transform)){
    difference = vector()
    diff_name = vector()
    for(k in 1:length(list)){
      Data$X[x] = x
      Data$Grandparent_Variance[x] = signif(var(vect[[i]]), 4)
      Data$Parent_Variance[x] = signif(var(transform[[j]]), 4)
      Data$Dataset[x] = vect1[i]
      if(transform_name[j] %in% `_`){
        Data$Transformation[x] = "none"}
      if(transform_name[j] %in% bc){
        Data$Transformation[x] = "Box-Cox"}
      if(transform_name[j] %in% log){
        Data$Transformation[x] = "Log"}
      if(transform_name[j] %in% sqrt){
        Data$Transformation[x] = "Square Root"}
      if(i %in% c(1,8,15,22,28,34,40,47,54,61,68,75,82)){
        Data$Average[x] = "Daily"}
      if(i %in% c(2,9,16,23,29,35,41,48,55,62,69,76,83)){
        Data$Average[x] = "Weekly"}
      if(i %in% c(3,10,17,24,30,36,42,49,56,63,70,77,84)){
        Data$Average[x] = "Bi-Daily"}
      if(i %in% c(4,11,18,25,31,37,43,50,57,64,71,78,85)){
        Data$Average[x] = "Tri-Daily"}
      if(i %in% c(5,12,19,26,32,38,44,51,58,65,72,79,86)){
        Data$Average[x] = "Quad-Daily"}
      if(i %in% c(6,13,20,27,33,39,45,52,59,66,73,80,87)){
        Data$Average[x] = "Penta-Daily"}
      if(i %in% c(7,14,21,28,34,40,46,53,60,67,74,81,88)){
        Data$Average[x] = "Sext-Daily"}
      
      if(list[k]==0){
        diff_name = append(diff_name, paste0(transform_name[j], "(", list[k], ")"))
        Data[x,1] = transform_name[j]
        Data$Differencing[x] = "Lag = none, Period = none"
        difference = append(difference, transform[j])
        Data$AICc[x] = Data$Parent_Variance[x]
        Data$Variance[x] = signif(var(transform[[j]]), 4)
        Data$Nonseasonal_Variance[x] = Data$Variance[x]
        Data$Seasonal_Variance[x] = Data$Variance[x]}
      diff_name = append(diff_name, paste0(transform_name[j], "(", list[k], ")"))
      if(list[k]==1){
        diff_name = append(diff_name, paste0(transform_name[j], "(", list[k], ")"))
        arima = arima(transform[[j]], order = c(0,1,0), method="ML")$residuals
        Data$AICc[x] = try(AICc(arima), silent = TRUE)
        Data[x,1] = paste0(transform_name[j], "(", list[k], ")")
        Data$Differencing[x] = "Lag = 1, Period = none"
        difference = append(difference, data.frame(arima$residuals))
        Data$Variance[x] = signif(var(arima$residuals), 4)
        Data$Nonseasonal_Variance[x] = Data$Variance[x]
        Data$Seasonal_Variance[x] = Data$Variance[x]}
      if(list[k]==7 | list[k]==12){
        diff_name = append(diff_name, paste0(transform_name[j], "(", list[k], ")"))
        arima = arima(transform[[j]], order = c(0,0,0), seasonal=list(
            order=c(0,1,0), period = list[k]), method="ML")
        Data$AICc[x] = try(AICc(arima), silent = TRUE)
        Data[x,1] = paste0(transform_name[j], "(", list[k], ")")
        Data$Differencing[x] = paste0("Lag = none, Period = ", list[k])
        difference = append(difference, data.frame(arima$residuals))
        Data$Variance[x] = signif(var(arima$residuals), 4)
        Data$Seasonal_Variance[x] = Data$Variance[x]}
      if(list[k]==7){
        Data$Nonseasonal_Variance[x] = Data$Variance[x-2]}
      if(list[k]==12){
        Data$Nonseasonal_Variance[x] = Data$Variance[x-3]}
      if(list[k]==1.7){
        diff_name = append(diff_name, paste0(transform_name[j], "(", list[k], ")"))
        arima = arima(transform[[j]], order = c(0,1,0), seasonal=list(
            order=c(0,1,0), period = 7), method="ML")
        Data$AICc[x] = try(AICc(arima), silent = TRUE)
        Data[x,1] = paste0(transform_name[j], "(", list[k], ")")
        Data$Differencing[x] = "Lag = 1, Period = 7"
        difference = append(difference, data.frame(arima$residuals))
        Data$Variance[x] = signif(var(arima$residuals), 4)
        Data$Nonseasonal_Variance[x] = Data$Nonseasonal_Variance[x-3]
        Data$Seasonal_Variance[x] = Data$Seasonal_Variance[x-2]}
      if(list[k]==1.12){
        diff_name = append(diff_name, paste0(transform_name[j], "(", list[k], ")"))
        arima = arima(transform[[j]], order = c(0,1,0), seasonal=list(
            order=c(0,1,0), period = 12), method="ML")
        Data$AICc[x] = try(AICc(arima), silent = TRUE)
        Data[x,1] = paste0(transform_name[j], "(", list[k], ")")
        Data$Differencing[x] = "Lag = 1, Period = 12"
        difference = append(difference, data.frame(arima$residuals))
        Data$Nonseasonal_Variance[x] = Data$Nonseasonal_Variance[x-4]
        Data$Seasonal_Variance[x] = Data$Seasonal_Variance[x-2]
        Data$Variance[x] = signif(var(arima$residuals), 4)
        Difference = append(Difference, difference)}
      
      Data[x, 7] = round(ad.test(difference[[k]])$p.value, digits=5)
      
      Data[x, 8] = round(shapiro.test(difference[[k]])$p.value, digits=5)
      
      Data[x, 9] = round(adf.test(difference[[k]])$p.value, digits=5)
      
      Data[x, 10] = round(kpss.test(difference[[k]])$p.value, digits=5)
      
      Data[x, 11] = round(Box.test(difference[[k]], lag=sqrt(length(
        difference[[k]])), type=c("Box-Pierce"), fitdf = 0)$p.value, digits=5)
      
      Data[x, 12] = round(Box.test(difference[[k]], lag=sqrt(length(
        difference[[k]])), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=5)
      
      Data[x, 13] = round(Box.test((difference[[k]])^2, lag=sqrt(length(
        difference[[k]])), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=5)
      
      Data$Pass[x]=0
      for(z in c(7,8, 10:13)){
        if(Data[x,z]>=0.05){
          Data$Pass[x] = 1 + Data$Pass[x]}}
      if(Data[x, 9] <= 0.05){
        Data$Pass[x] = 2 + Data$Pass[x]}
      Variance_Order = data.frame(matrix(ncol=3, nrow=5))
      colnames(Variance_Order) = c("Levels", "Variance", "Rank")
      Variance_Order$Levels = c("Original", "Transformation", "Differencing", 
                                "Seasonality", "Current")
      Variance_Order$Variance[1:5] = Data[x, c(14:18)]
      Variance_Order$Variance = as.double(Variance_Order$Variance)
      Variance_Order$Rank = as.integer(rank(Variance_Order$Variance, ties.method = "min"))
      Data$Variance_test[x] = paste0(
        Variance_Order$Rank[1], ", ", Variance_Order$Rank[2],
        ", ", Variance_Order$Rank[3], ", ", Variance_Order$Rank[4], ", ", 
        Variance_Order$Rank[5])
      Fails = 0
      if(Data[x, 14] < Data[x, 15]){
        Fails=Fails+1}
      if((Data[x, 15] < Data[x, 16]) & (Data[x, 15] < Data[x, 17])){
        Fails=Fails+1}
      if((Data[x, 14] < Data[x, 16]) & (Data[x, 14] < Data[x, 17])){
        Fails=Fails+1}
      if((Data[x, 16] < Data[x, 18]) & (Data[x, 17] < Data[x, 18])){
        Fails=Fails+1}
      if(Data[x, 14] < Data[x, 18]){
        Fails=Fails+1}
      if(Data[x, 15] < Data[x, 18]){
        Fails=Fails+1}
      Data$Pass[x] = (6-Fails)/6 + Data$Pass[x]
      if(Data$Pass[x] >= 6){
        # None of the undifferenced transformations for each data set are part of the best models
        if(list(k)==0){
          list1 = list("ARIMA(0,0,0)", x, i, transform_name[j])
          Best_Models1 = append(Best_Models1, list1)
          Best_Models = append(Best_Models, difference[k])}
        if(list[k]==1){
          list1 = list("ARIMA(0,1,0)", x, i, transform_name[j])
          Best_Models1 = append(Best_Models1, list1)
          Best_Models = append(Best_Models, difference[k])}
        if(list[k]==7){
          list1 = list("ARIMA(0,7,0)", x, i, transform_name[j])
          Best_Models1 = append(Best_Models1, list1)
          Best_Models = append(Best_Models, difference[k])}
        if(list[k]==12){
          list1 = list("ARIMA(0,12,0)", x, i, transform_name[j])
          Best_Models1 = append(Best_Models1, list1)
          Best_Models = append(Best_Models, difference[k])}
        if(list[k]==1.7){
          list1 = list("SARIMA(0,1,0)x(0,1,0)_7", x, i, transform_name[j])
          Best_Models1 = append(Best_Models1, list1)
          Best_Models = append(Best_Models, difference[k])}
        if(list[k]==1.12){
          list1 = list("SARIMA(0,1,0)x(0,1,0)_12", x, i, transform_name[j])
          Best_Models1 = append(Best_Models1, list1)
          Best_Models = append(Best_Models, difference[k])}}
      Pass1 = 0 
      for(s in 11:13){
        if(Data[x,s] >= 0.05){
          Pass1 = Pass1 + 1}}
      if(Pass1 >= 3){
        Data_a$Residual_Tests[x] = "Pass3"}
      if(Pass1 > 1 & Pass1 < 3){
        Data_a$Residual_Tests[x] = "Pass2"}
      if(Pass1 > 0 & Pass1 < 2){
        Data_a$Residual_Tests[x] = "Pass1"}
      if(Pass1 == 0){
        Data_a$Residual_Tests[x] = "Fail"}
      Pass2 = 0
      if(Data[x,7] >= 0.05){
        Pass2 = Pass2 + 1}
      if(Data[x,8] >= 0.05){
        Pass2 = Pass2 + 1}
      if(Pass2 >= 1){
        Data$Normality_Tests[x] = "Pass"}
      else{
        Data$Normality_Tests[x] = "Fail"}
      Pass3 = 0
      if(Data[x,10] >= 0.05){
        Pass3 = Pass3 + 1}
      if(Data[x,9] <= 0.05){
        Pass3 = Pass3 + 1}
      if(Pass3 >= 1){
        Data$Stationarity_Tests[x] = "Pass"}
      else{
        Data$Stationarity_Tests[x] = "Fail"}
      x = x + 1}}}

Dict1 = dict(init_keys = NULL, init_values = NULL)
for(i in 1:576){
  Dict1[Data$Name[i]] = Difference1[[i]]}

Data["Dict"] = 2

Data1 = subset(Data, Data$Pass >= 4)
Data1

Stationarity = subset(Data, Data$Stationarity_Tests == "Pass")
Stationarity
Normality = subset(Data, Data$Normality_Tests == "Pass")
Normality
Residuals = subset(Data, Data$Residual_Tests != "Fail")
Residuals


Stat_Norm = subset(Stationarity, Stationarity$Normality_Tests == "Pass")
Stat_Norm_Pass = subset(Stat_Norm, Stat_Norm$Pass >=4)
Stat_Res = subset(Stationarity, Stationarity$Residual_Tests != "Fail")
Stat_Res_Pass = subset(Stat_Res, Stat_Res$Pass >=4)
Stat_Res_Norm = subset(Stat_Res, Stat_Res$Normality_Tests == "Pass")
Res_Norm = subset(Residuals, Residuals$Normality_Tests == "Pass")
```



```{r}
Stat_Norm1 = rbind(Stat_Norm, Stat_Norm_a)
Stat_Norm1
Stat_Res1 = rbind(Stat_Res, Stat_Res_a)
Res_Norm1 = rbind(Res_Norm, Res_Norm_a)
Stat_Res_Norm1 = rbind(Stat_Res_Norm, Stat_Res_Norm_a)
Stat_Res_Norm1
```


```{r}
source("plot.roots.R")
Data2 <- subset(Data, Data$`Augmented Dickey-Fuller Test`<= 0.05 & Data$`KPSS Test` >= 0.05 & Data$`Anderson-Darling Test` >= 0.05 & Data$`Shapiro test` >= 0.05)

Data2_minAIC = subset(Data2, Data2$AICc == min(Data2$AICc))
Data2_minAIC$Name

x = auto.arima(`Cases2b.sqrt(1.7)`, start.p = 0, start.q = 0, d=1, D=1, start.P = 0, start.Q = 0, stationary=TRUE, seasonal = TRUE, allowmean=TRUE, trace = TRUE)

acvf = acf(Mortality.diff, plot=FALSE, lag.max = length(Mortality.diff))$acf[,1,1] * var(Mortality.diff) 
m = length(acvf)
lh.ia = innovations.algorithm(m+1, acvf)
lh.ia$thetas[9,1:9] # Preliminary estimates of coefficients for MA(9)
lh.ia$thetas[10,1:10] # Preliminary estimates of coefficients for MA(10)
lh.ia$thetas[11,1:11] # Preliminary estimates of coefficients for MA(11)
lh.ia$thetas[12,1:12]
x

grepl()

da = subset(Data_a, Data_a$Pass == max(Data_a$Pass))

vect=vector()
vect=append(vect, 1)
vect=append(vect, 1)
vect=append(vect, 1)
vect=append(vect, 1)
vect=append(vect, 1)
vect1=vector()
vect1=append(vect1, 1)
vect1=append(vect1, 1)
vect1=append(vect1, 1)
vect1=append(vect1, 1)
vect1=append(vect1, 1)
vect=append(vect, vect1)
vect
y = arima(`Cases2b.sqrt(1.7)`,order=c(3,0,1), method="ML")
```

```{r}

bcTransform <- boxcox(vect[[12]]~ as.numeric(1:length(vect[[12]])))       # plot the graph

decomp = decompose(`Mort2b.bc`$X.1.lambda.....vect..i...lambda...1.)








  bcTransform$x[which(bcTransform$y == max(bcTransform$y))] # gives the value of λ
  lambda=bcTransform$x[which(bcTransform$y == max(bcTransform$y))]
  title(main = paste0(vect1[i], "  lambda = ", lambda))
  
  
plot_fn = function(name, arima){
  res = arima$residuals
  x=acf2(res, main=name)
  mtext(paste0("Shapiro: ", round(shapiro.test(res)$p.value, digits=3), "     McLeod-Li: ", round(Box.test((res)^2, lag=sqrt(length(res)), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=3), "     ad.test: ", round(ad.test(res)$p.value, digits=3)), side=1, line=-6.5, adj=0, cex=0.7)
  mtext(paste0("Box-Pierce: ", round(Box.test(res, lag = sqrt(length(res)), type = c("Box-Pierce"), fitdf = 0)$p.value, digits=3), "     adf.test: ", round(adf.test(res)$p.value, digits=3), "     Ljung-Box: ", round(Box.test(res, lag=sqrt(length(res)), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=3), "     kpss.test: ", round(kpss.test(res)$p.value, digits=3)), side=1, line=-5.5, adj=0, cex=0.7)
  op <- par("mfrow", "mar")
  par(mfrow = c(3, 2), mar = c(rep.int(2, 3), 0.5))
  res = arima$residuals
  uc.check(pol_ = c(1, arima$coef[1:length(arima$coef)-1]), plot_output = TRUE)
  require(TSA)
  plot.ts(res, main=name)
  abline(h=mean(res), col= "blue")
  abline(lm(res ~ as.numeric(1:length(res))), col="red")
  TSA::periodogram(res, log = 'yes', main=paste0(name, " Periodogram"), cex.main=0.6)
  TSA::periodogram(res, log = 'no', main=paste0(name, " Periodogram"), cex.main=0.6)
  abline(h=0)
  hist(res, col="light blue", xlab="", main=name, prob=TRUE)
  mtext(paste0("Variance = ", round(var(res), digits = 4)), side=1, line = 3, cex = 0.8)
  m <- mean(res)
  std <- sqrt(var(res))
  x = res
  curve( dnorm(x,m,std), add=TRUE)
  qqnorm(res,main= paste0(name, " Q-Q Plot"), cex.main=0.8)
  qqline(res,col="blue")
  cpgram(res, main=name)
  par(mfrow = op$mfrow, mar = op$mar)}

plot_fxn = function(name, res){
  x=acf2(res, main=name)
  mtext(paste0("Shapiro: ", round(shapiro.test(res)$p.value, digits=3), "     McLeod-Li: ", round(Box.test((res)^2, lag=sqrt(length(res)), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=3), "     ad.test: ", round(ad.test(res)$p.value, digits=3)), side=1, line=-6.5, adj=0, cex=0.7)
  mtext(paste0("Box-Pierce: ", round(Box.test(res, lag = sqrt(length(res)), type = c("Box-Pierce"), fitdf = 0)$p.value, digits=3), "     adf.test: ", round(adf.test(res)$p.value, digits=3), "     Ljung-Box: ", round(Box.test(res, lag=sqrt(length(res)), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=3), "     kpss.test: ", round(kpss.test(res)$p.value, digits=3)), side=1, line=-5.5, adj=0, cex=0.7)
  op <- par("mfrow", "mar")
  par(mfrow = c(3, 2), mar = c(rep.int(2, 3), 0.5))
  require(TSA)
  plot.ts(res, main=name)
  abline(h=mean(res), col= "blue")
  abline(lm(res ~ as.numeric(1:length(res))), col="red")
  TSA::periodogram(Dict.res["Vax3b.log(12)"], log = 'yes', main=paste0(name, " Periodogram"), cex.main=0.6)
  TSA::periodogram(res, log = 'no', main=paste0(name, " Periodogram"), cex.main=0.6)
  abline(h=0)
  hist(res, col="light blue", xlab="", main=name, prob=TRUE)
  mtext(paste0("Variance = ", round(var(res), digits = 4)), side=1, line = 3, cex = 0.8)
  m <- mean(res)
  std <- sqrt(var(res))
  x = res
  curve( dnorm(x,m,std), add=TRUE)
  source("plot.roots.R")
  qqnorm(res,main= paste0(name, " Q-Q Plot"), cex.main=0.8)
  qqline(res,col="blue")
  cpgram(res, main=name)
  par(mfrow = op$mfrow, mar = op$mar)}

ar(Residuals, aic = TRUE, order.max = NULL, method = c("yule-walker"))
ar(Residuals, aic = TRUE, order.max = NULL, method = c("mle"))


Residuals1 = rbind(Residuals, Residuals_a)

Dict.res = dict(init_keys = NULL, init_values = NULL)

for(t in 1:length(Residuals1$Name)){
  par(mfrow = c(3, 2), mar = c(rep.int(2, 3), 0.5))
  name = Residuals1$Name[t]
  if(Residuals1$Dict[t] == 1){
    res = Dict[name]}
  else{
    res = Dict1[name]}
  Dict.res[name] = res}

# Vax3b.log(1)
plot_fxn("Vax3b.log(1)", Dict.res["Vax3b.log(1)"])
arima1 = arima(Dict.res["Vax3b.log(1)"], order = c(1,0,0), method = "ML")
x = exp(arima1$residuals)
Residuals = arima1$residuals
plot_fn("Vax3b.log(1)(1,0,0)", arima1)
polyroot(c(1, arima1$coef[1:length(arima1$coef)-1]))
plot_fxn("Vax3b(1)(1,0,0)", x)
ar(Residuals, aic = TRUE, order.max = NULL, method = c("yule-walker"))
ar(Residuals, aic = TRUE, order.max = NULL, method = c("mle"))
arima1_1 = arima(Vax3b$Vax3b, order = c(1,1,0), method="ML")
plot_fn("Vax3b(1,1,0)", arima1_1)

# Best = "Vax3b(1,1,0)"

--------------------------------------------------------------------
# Vax3b.log(1.7)
plot_fxn("Vax3b.log(1.7)", Dict.res["Vax3b.log(1.7)"])
arima2 = arima(Dict.res["Vax3b.log(1.7)"], order = c(1,0,0), method = "ML")
x = exp(arima2$residuals)
Residuals = arima2$residuals
plot_fn("Vax3b.log(1.7)(1,0,0)", arima2)
polyroot(c(1, arima2$coef[1:length(arima2$coef)-1]))
plot_fxn("Vax3b(1.7)(1,0,0)", x)
ar(Residuals, aic = TRUE, order.max = NULL, method = c("yule-walker"))
ar(Residuals, aic = TRUE, order.max = NULL, method = c("mle"))
arima2_1 = arima(Vax3b$Vax3b, order = c(1,1,0), seasonal = list(order=c(0,1,0), period= 7), method = "ML")
plot_fn("Vax3b(1,1,0)(0,1,0)_7", arima2_1)

# Best = "Vax3b(1,1,0)(0,1,0)_7"

-------------------------------------------------------------------------


# Vax3b.log(1.12)
plot_fxn("Vax3b.log(1.12)", Dict.res["Vax3b.log(1.12)"])
arima3 = arima(Dict.res["Vax3b.log(1.12)"], order = c(1,0,0), method = "ML")
x = exp(arima3$residuals)
Residuals = arima3$residuals
plot_fn("Vax3b.log(1.12)(1,0,0)", arima3)
polyroot(c(1, arima3$coef[1:length(arima3$coef)-1]))
plot_fxn("Vax3b(1.12)(1,0,0)", x)
ar(Residuals, aic = TRUE, order.max = NULL, method = c("yule-walker"))
ar(Residuals, aic = TRUE, order.max = NULL, method = c("mle"))
arima3_1 = arima(Vax3b$Vax3b, order = c(1,1,0), seasonal = list(order=c(0,1,0), period= 12), method = "ML")
plot_fn("Vax3b(1,1,0)(0,1,0)_12", arima3_1)

# Best = "Vax3b(1,1,0)(0,1,0)_12"

------------------------------------------------------------------------
  
# Vax3b.log1(1)
plot_fxn("Vax3b.log1(1)", Dict.res["Vax3b.log1(1)"])
arima1 = arima(Dict.res["Vax3b.log1(1)"], order = c(1,0,0), method = "ML")
x = exp(arima1$residuals)
Residuals = arima1$residuals
plot_fn("Vax3b.log1(1)(1,0,0)", arima1)
polyroot(c(1, arima1$coef[1:length(arima1$coef)-1]))
plot_fxn("Vax3b(1)(1,0,0)", x)
ar(Residuals, aic = TRUE, order.max = NULL, method = c("yule-walker"))
ar(Residuals, aic = TRUE, order.max = NULL, method = c("mle"))

--------------------------------------------------------------------
# Vax3b.log1(1.7)
plot_fxn("Vax3b.log1(1.7)", Dict.res["Vax3b.log1(1.7)"])
arima2 = arima(Dict.res["Vax3b.log1(1.7)"], order = c(1,0,0), method = "ML")
x = exp(arima2$residuals)
Residuals = arima2$residuals
plot_fn("Vax3b.log1(1.7)(1,0,0)", arima2)
polyroot(c(1, arima2$coef[1:length(arima2$coef)-1]))
plot_fxn("Vax3b(1.7)(1,0,0)", x)
ar(Residuals, aic = TRUE, order.max = NULL, method = c("yule-walker"))
ar(Residuals, aic = TRUE, order.max = NULL, method = c("mle"))

-------------------------------------------------------------------------


# Vax3b.log1(1.12)
plot_fxn("Vax3b.log1(1.12)", Dict.res["Vax3b.log1(1.12)"])
arima3 = arima(Dict.res["Vax3b.log1(1.12)"], order = c(1,0,0), method = "ML")
x = exp(arima3$residuals)
Residuals = arima3$residuals
plot_fn("Vax3b.log1(1.12)(1,0,0)", arima3)
polyroot(c(1, arima3$coef[1:length(arima3$coef)-1]))
plot_fxn("Vax3b1(1.12)(1,0,0)", x)
ar(Residuals, aic = TRUE, order.max = NULL, method = c("yule-walker"))
ar(Residuals, aic = TRUE, order.max = NULL, method = c("mle"))



# Mort2b.bc1(1.12)
plot_fxn("Mort2b.bc1(1.12)", Dict1["Mort2b.bc1(1.12)"])
arima = arima(Dict1["Mort2b.bc(0)"], order=c(1,1,0), seasonal = list(order=c(0,1,0), period=12), method="ML", include.mean=FALSE)
plot_fn("Mort2b.bc1(1.12)", arima)
Residuals =Dict1["Mort2b.bc1(1.12)"]
ar(Residuals, aic = TRUE, order.max = NULL, method = c("yule-walker"))
ar(Residuals, aic = TRUE, order.max = NULL, method = c("mle"))
arima2_1 = arima(Dict["Mort2b.bc"], order = c(0,1,0), seasonal = list(order=c(0,1,0), period= 12), method = "ML", include.mean = FALSE)
plot_fxn("Mort2b.bc(0,1,0)(0,1,0)_12", arima2_1)
 
forecast <- sarima.for(original, n.ahead=1, d=1)
x = predict(arima, h=3)
x$pred
Dict1["Mort2b.bc(0)"][1]
-22.08158^LAMBDA

original = bxcx(Dict1["Mort2b.bc(1.12)"], InverseQ = TRUE, lambda = lambda)

sarima.for(original, 128, 0,13,0, plot.all = TRUE)
lambda
Dict["Mort2b.bc"]
# Best = "Vax3b(1,1,0)(0,1,0)_7"


arima2 = arima(exp(Dict.res["Vax3b.log(1.7)"]), order = c(1,0,0), method = "ML")
x = exp(arima2$residuals)
plot_fn("Vax3b.log(1.7)(1,0,1)", arima2)
ar_fn(arima2$residuals)
plot(arima2)
plot(polyroot(c(1, 0.2444459)))
polyroot(arima1$coef)

```
```{r}
bcTransform <- boxcox(vect[[35]]~ as.numeric(1:length(vect[[35]])))       # plot the graph

  bcTransform$x[which(bcTransform$y == max(bcTransform$y))] # gives the value of λ
  lambda=bcTransform$x[which(bcTransform$y == max(bcTransform$y))]
  title(main = paste0(vect1[35], "  lambda = ", round(lambda, 3)))
  lambda

  
  

original = bxcx(Dict1["Mort2b.bc(1.12)"], InverseQ = TRUE, lambda = lambda)

plot(x=c(1:52), y=Mort1b$Mort1b[1:52], xlab="Time")
lines(x=c(1:52), y=Mort1b$Mort1b[1:52])
points(forecast$pred, col="red")

data=data.frame("Time"=c(1:175), Mort1b$Mort1b)

forecast=data.frame(forecast)

forecast<- forecast%>%
  mutate("lcl" = max(0, (forecast$pred - 1.96*forecast$se)))
forecast<- forecast%>%
  mutate("ucl" = forecast$pred + 1.96*forecast$se)
forecast["Time"] = c(47:175)

frame = data.frame(matrix(ncol=5, nrow=1))
colnames(frame) = colnames(forecast)
frame[1, 1:5] <- c(data$Mort1b.Mort1b[46], 0, 0, 0, data$Time[46])
forecast =  rbind(frame, forecast)

colors <- c("Forecasted" = "red", "Actual" = "grey")
ggplot(data[1:175, 1:2], aes(Time, original, color="grey")) + ylim(0.01, 0.02) + geom_line() + geom_point() + geom_line(data = forecast, aes(x=Time, y= pred, color="red")) + geom_point(data = forecast[2:7, 1:5], aes(x=Time, y= pred), color="red") + geom_ribbon(data = forecast, aes(x=Time, y=pred, ymin=lcl, ymax=ucl), color=NA, alpha=.2)+labs(color="Legend") + scale_color_manual(values = colors)

Dict1["Mort2b.bc(1.12)"]

pred.tr = predict(arima, n.ahead=12)
pred.tr$pred
pred = (abs(pred.tr$pred))^LAMBDA
U.tr= (abs(pred.tr$pred + 2*pred.tr$se))^LAMBDA
L.tr= (abs(pred.tr$pred - 2*pred.tr$se))^LAMBDA
ts.plot(Mort2b$Mort2b, xlim=c(1,length(arima$residuals)+12))
lines(U.tr, col="blue", lty="dashed")
lines(L.tr, col="blue", lty="dashed")
points((length(arima$residuals)+1):(length(arima$residuals)+12), pred, col="red")


• Forecasting using model A:
install.packages("forecast")
library(forecast)
fit.A <- arima(Mortality, order=c(0,1,3), seasonal = list(order = c(0,1,1), period = 12),
fixed = c(NA, 0, NA, NA), method="ML")
forecast(fit.A) % prints forecasts with prediction bounds in a table
• To produce graph with 12 forecasts on transformed data:
pred.tr <- predict(fit.A, n.ahead = 12)
U.tr= pred.tr$pred + 2*pred.tr$se % upper bound of prediction interval L.tr= pred.tr$pred - 2*pred.tr$se % lower bound
ts.plot(Mortality, xlim=c(1,length(Mortality)+12), ylim = c(min(Mortality),max(U.tr)))
lines(U.tr, col="blue", lty="dashed")
lines(L.tr, col="blue", lty="dashed")
points((length(Mortality)+1):(length(Mortality)+12), pred.tr$pred, col="red")
34

  • To produce graph with forecasts on original data:
pred.orig <- exp(pred.tr$pred)
U= exp(U.tr)
L= exp(L.tr)
ts.plot(Mortality, xlim=c(1,length(Mortality)+12), ylim = c(min(Mortality),max(U))) lines(U, col="blue", lty="dashed")
lines(L, col="blue", lty="dashed")
points((length(Mortality)+1):(length(Mortality)+12), pred.orig, col="red")
• To zoom the graph, starting from entry 100:
ts.plot(Mortality, xlim = c(100,length(Mortality)+12), ylim = c(250,max(U))) lines(U, col="blue", lty="dashed")
lines(L, col="blue", lty="dashed")
points((length(Mortality)+1):(length(Mortality)+12), pred.orig, col="red")
• To plot zoomed forecasts and true values (in Mortality):
ts.plot(Mortality, xlim = c(100,length(Mortality)+12), ylim = c(250,max(U)), col="red") lines(U, col="blue", lty="dashed")
lines(L, col="blue", lty="dashed")
points((length(Mortality)+1):(length(Mortality)+12), pred.orig, col="green")
points((length(Mortality)+1):(length(Mortality)+12), pred.orig, col="black")



```

# Plot, Box-Cox, Histogram, Periodogram, QQ-Plot, ACF/PACF
# V1
```{r, warning=FALSE}

for(t in 1:length(Residuals1$Name)){
  op <- par("mfrow", "mar")
  par(mfrow = c(3, 2), mar = c(rep.int(2, 3), 0.5))
  name = Residuals1$Name[t]
  if(Residuals1$Dict[t] == 1){
    res = Dict[name]}
  else{
    res = Dict1[name]}
  for(s in 1:length(res)){
    if(is.na(res)){
      res[s] = (res[s-1] + res[s+1])/2}}
  
  require(TSA)
  plot.ts(res, main=name)
  abline(h=mean(res), col= "blue")
  abline(lm(res ~ as.numeric(1:length(res))), col="red")
  TSA::periodogram(res, log = 'yes', main=paste0(name, " Periodogram"), cex.main=0.6)
  TSA::periodogram(res, log = 'no', main=paste0(name, " Periodogram"), cex.main=0.6)
  abline(h=0)
  hist(res, col="light blue", xlab="", main=name, prob=TRUE)
  mtext(paste0("Variance = ", round(var(res), digits = 4)), side=1, line = 3, cex = 0.8)
  m <- mean(res)
  std <- sqrt(var(res))
  x = res
  curve( dnorm(x,m,std), add=TRUE)
  qqnorm(res,main= paste0(name, " Q-Q Plot"), cex.main=0.8)
  qqline(res,col="blue")
  cpgram(res, main=name)
  par(mfrow = op$mfrow, mar = op$mar)
  x=acf2(res, main=name)
  mtext(paste0("Shapiro: ", round(shapiro.test(res)$p.value, digits=3), "     McLeod-Li: ", round(Box.test((res)^2, lag=sqrt(length(res)), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=3), "     ad.test: ", round(ad.test(res)$p.value, digits=3)), side=1, line=-6.5, adj=0, cex=0.7)
  mtext(paste0("Box-Pierce: ", round(Box.test(res, lag = sqrt(length(res)), type = c("Box-Pierce"), fitdf = 0)$p.value, digits=3), "     adf.test: ", round(adf.test(res)$p.value, digits=3), "     Ljung-Box: ", round(Box.test(res, lag=sqrt(length(res)), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=3), "     kpss.test: ", round(kpss.test(res)$p.value, digits=3)), side=1, line=-5.5, adj=0, cex=0.7)}
```

# Plot, Box-Cox, Histogram, Periodogram, QQ-Plot, ACF/PACF
# V2
```{r, warning=FALSE}


for(t in 1:length(Best_Models_a)){
  op <- par("mfrow", "mar")
  par(mfrow = c(3, 2), mar = c(rep.int(2, 3), 0.5))
  res = Best_Models_a[[t]]
  res = 
  z = 4* (t-1) +1
  zzz = 4*t-1
  zzzz=4*t
  Dict1$keys[Residuals$X[t]+2]
  name = paste0(Best_Models_a1[zzzz], "(", Best_Models_a1[z], ")")
  i = Best_Models_a1[[zzz]]
  j = Best_Models_a1[[zzzz]]
  if(j %in% bc){
    bcTransform <- boxcox(vect[[i]] ~ as.numeric(1:length(vect[[i]])))
    bcTransform$x[which(bcTransform$y == max(bcTransform$y))]
    lambda=bcTransform$x[which(bcTransform$y == max(bcTransform$y))]
    title(main = paste0(vect1[i], "  lambda = ", round(lambda, 3)))}
  require(TSA)
  plot.ts(res, main=name)
  abline(h=mean(res), col= "blue")
  abline(lm(res ~ as.numeric(1:length(res))), col="red")
  TSA::periodogram(res, log = 'yes', main=paste0(name, " Periodogram"), cex.main=0.6)
  TSA::periodogram(res, log = 'no', main=paste0(name, " Periodogram"), cex.main=0.6)
  abline(h=0)
  hist(res, col="light blue", xlab="", main=name, prob=TRUE)
  mtext(paste0("Variance = ", round(var(res), digits = 4)), side=1, line = 3, cex = 0.8)
  m <- mean(res)
  x = res
  std <- sqrt(var(res))
  curve( dnorm(x,m,std), add=TRUE)
  qqnorm(res,main= paste0(name, " Q-Q Plot"), cex.main=0.8)
  qqline(res,col="blue")
  cpgram(res, main=name)
  par(mfrow = op$mfrow, mar = op$mar)
  x=acf2(res, main=name)
  mtext(paste0("Shapiro: ", round(shapiro.test(res)$p.value, digits=3), "     McLeod-Li: ", round(Box.test((res)^2, lag=sqrt(length(res)), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=3), "     ad.test: ", round(ad.test(res)$p.value, digits=3)), side=1, line=-7.5, adj=0, cex=0.7)
    mtext(paste0("Box-Pierce: ", round(Box.test(res, lag = sqrt(length(res)), type = c("Box-Pierce"), fitdf = 0)$p.value, digits=3), "     adf.test: ", round(adf.test(res)$p.value, digits=3), "     Ljung-Box: ", round(Box.test(res, lag=sqrt(length(res)), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=3), "     kpss.test: ", round(kpss.test(res)$p.value, digits=3)), side=1, line=-6.5, adj=0, cex=0.7)}

```


```{r}
x
Data = data.frame(matrix(nrow=972, ncol=2))
colnames(Data) = c("Model", "AICc")

loop.s = c(12)
loop.p = c(0,1,2,3,4,5,12,15)
loop.d = c(0,1)
loop.q = c(0,1,2,3,4,5,12,15)
loop.P = c(0,1)
loop.Q = c(0,1)
loop.D = c(0)

i = 1
for(s in loop.s){
  for(D in loop.D){
    for(Q in loop.Q){
      for(P in loop.P){
        for(d in loop.d){
          for(q in loop.q){
            for(p in loop.p){
                Data[i, 1] = paste0("SARIMA(", p, ",", d+1, ",", q, ")x(", P, ",", D, ",", Q, ")_", s)
                assign(paste0("SARIMA(", p, ",", d+1, ",", q, ")x(", P, ",", D, ",", Q, ")_", s), 
                       try(arima(Best_Models_a[[12]], order=c(p,d,q), seasonal=list(order=c(P,D,Q), period=s), method="ML")))
                Data[i, 2] = try(AIC(get(paste0("SARIMA(", p, ",", d+1, ",", q, ")x(", P, ",", D, ",", Q, ")_", s))))
                x=try(acf2(get(paste0("SARIMA(", p, ",", d+1, ",", q, ")x(", P, ",", D, ",", Q, ")_", s))$residuals, 
                       main = paste0("SARIMA(", p, ",", d+1, ",", q, ")x(", P, ",", D, ",", Q, ")_", s, "  AICc = ", Data[i,2])))
                }
              }}}}}}

```



```{r}
Data_aa = data.frame(matrix(nrow=10000, ncol=3))
colnames(Data_aa) = c("Model", "AICc", "Pass")

i = 1
for(x in 1:length(Best_Models_a)){
  min = vector()
  if(ar(Best_Models_a[[1]], aic = TRUE, order.max = NULL, method = c("yule-walker"))$order > 0){
    min = append(min, ar(Best_Models_a[[1]], aic = TRUE, order.max = NULL, method = c("yule-walker"))$order)}
  if(ar(Best_Models_a[[1]], aic = TRUE, order.max = NULL, method = c("mle"))$order > 0){
    min = append(min, ar(Best_Models_a[[1]], aic = TRUE, order.max = NULL, method = c("mle"))$order)}
  if(ar(Best_Models_a[[1]], aic = TRUE, order.max = NULL, method = c("ols"))$order > 0){
    min = append(min, ar(Best_Models_a[[1]], aic = TRUE, order.max = NULL, method = c("ols"))$order)}
  if(ar(Best_Models_a[[1]], aic = FALSE, order.max = NULL, method = c("yule-walker"))$order > 0){
    min = append(min, ar(Best_Models_a[[1]], aic = FALSE, order.max = NULL, method = c("yule-walker"))$order)}
  if(ar(Best_Models_a[[1]], aic = FALSE, order.max = NULL, method = c("mle"))$order > 0){
    min = append(min, ar(Best_Models_a[[1]], aic = FALSE, order.max = NULL, method = c("mle"))$order)}
  if(ar(Best_Models_a[[1]], aic = FALSE, order.max = NULL, method = c("ols"))$order > 0){
    min = append(min, ar(Best_Models_a[[1]], aic = FALSE, order.max = NULL, method = c("ols"))$order)}
  min1 = sort(min)[1]

  num = 4 * (x-1) + 2
  Set = 4 * (x-1) + 3
  name = Best_Models_a1[[Set]]
  Name = vect1[name]
  number = Best_Models_a1[[num]]
  if(Data_a$Differencing[[number]] == "Lag = 1 & Lag = 7"){
    s = 7
    d = 1
    D = 1}
  if(Data_a$Differencing[[number]] == "Lag = 1 & Lag = 12"){
    s = 12
    d = 1
    D = 1}
  if(Data_a$Differencing[[number]] == "Lag = 1"){
    s = 0
    d = 1
    D = 0}
  if(Data_a$Differencing[[number]] == "Lag = 7"){
    s = 7
    d = 0
    D = 1}
  if(Data_a$Differencing[[number]] == "Lag = 12"){
    s = 12
    d = 0
    D = 1}
  
  if(min >= 4){
    loop.p = c(0,1,2,min1-1,min1)
    loop.q = c(0,1,2,min1-1,min1)}
  else{
    loop.p = c(seq(0,5))
    loop.q = c(seq(0,5))}

  loop.P = c(0,1,2)
  loop.Q = c(0,1,2)
  
  for(Q in loop.Q){
    for(P in loop.P){
      for(q in loop.q){
        for(p in loop.p){
          print(paste0(i, ".", x))
          Data_aa[i, 1] = paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s)
          assign(paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s), 
                 try(arima(Best_Models_a[[x]], order=c(p,d,q), seasonal=list(
                   order=c(P,D,Q), period=s), method="ML")))
          Data_aa[i, 2] = try(AIC(get(paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s))))
          res = try(get(paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s))$residuals)
          Data_aa$Pass[i] = 0
          if(try(round(ad.test(difference[[k]])$p.value, digits=5) >= 0.05) |
             try(round(shapiro.test(difference[[k]])$p.value, digits=5) >= 0.05)){
            Data_aa$Pass[i] = Data_aa$Pass[i] + 1}
          if(try(round(adf.test(difference[[k]])$p.value, digits=5) <= 0.05) |
             try(round(kpss.test(difference[[k]])$p.value, digits=5) >= 0.05)){
            Data_aa$Pass[i] = Data_aa$Pass[i] + 1}
          if(try(round(Box.test(difference[[k]], lag=sqrt(length(
            difference[[k]])), type=c("Box-Pierce"), fitdf = 0)$p.value, digits=5) >= 0.05)){
            Data_aa$Pass[i] = Data_aa$Pass[i] + 1}
          if(try(round(Box.test(difference[[k]], lag=sqrt(length(
            difference[[k]])), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=5) >= 0.05)){
            Data_aa$Pass[i] = Data_aa$Pass[i] + 1}
          if(try(round(Box.test((difference[[k]])^2, lag=sqrt(length(
            difference[[k]])), type=c("Ljung-Box"), fitdf = 0)$p.value, digits=5) >= 0.05)){
            Data_aa$Pass[i] = Data_aa$Pass[i] + 1}
          if(Data_aa$Pass[i] >= 3){
            z=try(acf2(res, main = paste0(Name, "SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s, "  AICc = ", Data_aa[i,2]), cex=0.8))
            try(mtext(paste0("Shapiro: ", round(shapiro.test(res)$p.value, digits=3), 
                             "     McLeod-Li: ", round(Box.test((res)^2, lag=sqrt(length(res)), type=c("Ljung-Box"), 
                                                                fitdf = 0)$p.value, digits=3),
                             "     ad.test: ", round(ad.test(res)$p.value, digits=3)), 
                      side=3, line=-9, adj=0, cex=0.7))
            try(mtext(paste0("Box-Pierce: ", round(Box.test(res, lag = sqrt(length(res)), type = c("Box-Pierce"), 
                                                            fitdf = 0)$p.value, digits=3), 
                             "     adf.test: ", round(adf.test(res)$p.value, digits=3), 
                             "     Ljung-Box: ", round(Box.test(res, lag=sqrt(length(res)), type=c("Ljung-Box"), 
                                                            fitdf = 0)$p.value, digits=3), 
                             "     kpss.test: ", round(kpss.test(res)$p.value, digits=3)), 
                      side=3, line=-10, adj=0, cex=0.7))}
                i=i+1}}}}}

```




```{r}
source('plot.roots.R')




read_file('plot.roots.R')
plot.roots(`SARIMA(5,1,5)x(1,0,1)_7`)
`SARIMA(5,1,5)x(1,0,1)_7`
`SARIMA(5,1,5)x(1,0,1)_7(fixed)` = arima(Mortality, order = c(5,1,5), seasonal=list(order=c(1,0,1), period=7), method="ML", fixed = c(0,0,0,0,0,0,0,0,0,0,0,NA))
acf2(`SARIMA(5,1,5)x(1,0,1)_7(fixed)`$residuals)    

`SARIMA(5,1,4)x(0,0,1)_7(fixed)` = arima(Mortality, order=c(5,1,4), seasonal=list(order=c(0,0,1), period=7), method="ML", fixed= c(0, NA, NA, NA, NA, NA, NA, NA, NA, NA))

acf(`SARIMA(5,1,4)x(0,0,1)_7(fixed)`$residuals)
mtext("hello",  side=1, srt=-90, line=2, h.just=2)
`SARIMA(5,1,5)x(0,0,2)_7`

`SARIMA(5,1,5)x(0,0,2)_7(fixed)` = arima(Mortality, order=c(5,1,5), seasonal=list(order=c(0,0,2), period=7), method="ML", fixed= c(0, NA, NA, NA, NA, NA, NA, 0, NA, NA, NA, NA))
acf2(`SARIMA(5,1,5)x(0,0,2)_7(fixed)`$residuals)
x=Box.test(`SARIMA(4,1,4)x(2,0,1)_7`$residuals, lag=40, type=c("Box-Pierce"), fitdf = 11)
x$p.value
`SARIMA(3,1,2)x(1,0,1)_7`
kpss.test(`SARIMA(4,1,4)x(2,0,1)_7`$residuals)
check.statio
acf2(`SARIMA(3,1,2)x(2,0,1)_7`$residuals)

`SARIMA(3,1,2)x(1,0,1)_7(fixed)` = arima(Mortality, order=c(3,1,2), seasonal=list(order=c(1,0,1), period=7), method="ML", fixed= c(NA, 0, NA, NA, NA, 0, NA))
acf2(`SARIMA(3,1,2)x(1,0,1)_7(fixed)`$residuals)
adf
kpss.test(`SARIMA(4,1,4)x(2,0,1)_7`$residuals)
autoplot(`SARIMA(4,1,4)x(2,0,1)_7`$residuals)
plot(`SARIMA(4,1,4)x(2,0,1)_7`$root)

`SARIMA(3,1,2)x(1,0,1)_7(fixed)` = arima(Mortality, order=c(3,1,2), seasonal=list(order=c(1,0,1), period=7), method="ML", fixed= c(NA, 0, NA, NA, NA, 0, NA))
acf2(`SARIMA(3,1,2)x(1,0,1)_7(fixed)`$residuals)

acf2(arima(Mortality, order = c(5,1,5), seasonal=list(order=c(1,0,1), period=7), method="ML")$residuals)



acf2(`SARIMA(4,1,4)x(2,0,1)_7`$residuals)
mtext(paste0("Box-Pierce: p-value = ", signif(Box.test(`SARIMA(4,1,4)x(2,0,1)_7`$residuals, lag=sqrt(1228), type=c("Box-Pierce"), fitdf = 11)$p.value, digits=3), "________________________________Ljung-Box: p-value = ", signif(Box.test(`SARIMA(4,1,4)x(2,0,1)_7`$residuals, lag=sqrt(1228), type=c("Ljung-Box"), fitdf = 11)$p.value, digits=3)),  side=1, line=-6, adj=0, cex=.8)
mtext(paste0("McLeod-Li: p-value = ", signif(Box.test((`SARIMA(4,1,4)x(2,0,1)_7`$residuals)^2, lag=sqrt(1228), type=c("Ljung-Box"), fitdf = 11)$p.value, digits=3), "_________________________________Shapiro: p-value = ", signif(shapiro.test(`SARIMA(4,1,4)x(2,0,1)_7`$residuals)$p.value, digits=3)),  side=1, line=-7, adj=0, cex=.8)


```


```{r}
Data = data.frame(matrix(nrow=972, ncol=2))
colnames(Data) = c("Model", "AICc")

loop.s = c(7)
loop.p = c(0,1,2,3,4,5)
loop.d = c(1)
loop.q = c(0,1,2,3,4,5)
loop.P = c(0,1,2)
loop.Q = c(0,1,2)
loop.D = c(0,1,2)

i = 1
for(s in loop.s){
  for(D in loop.D){
    for(Q in loop.Q){
      for(P in loop.P){
        for(d in loop.d){
          for(q in loop.q){
            for(p in loop.p){
              if((p==3 & d==1 & q==2 & P==1 & Q==1 & D==0) | (p==5 & d==1 & q==5 & P==1 & Q==1 & D==0) | (p==3 & d==1 & q==2 & P==2 & Q==1 & D==0) | (p==1 & d==1 & q==3 & P==2 & Q==1 & D==0) | (p==4 & d==1 & q==4 & P==2 & Q==1 & D==0)){
                Data[i, 1] = paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s)
                assign(paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s), 
                       arima(Mortality2a, order=c(p,d,q), seasonal=list(order=c(P,D,Q), period=s)))
                Data[i, 2] = AIC(get(paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s)))
                x=acf2(get(paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s))$residuals, 
                       main = paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s, "  AICc = ", Data[i,2]))}
              else{
                if(P==0 & Q==0 & D==0){
                  Data[i, 1] = paste0("ARIMA(", p, ",", d, ",", q, ")")}
                else{
                  Data[i, 1] = paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s)}
                assign(paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s), 
                       arima(Mortality, order=c(p,d,q), seasonal=list(order=c(P,D,Q), period=s), method="ML"))
                Data[i, 2] = AIC(get(paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s)))
                x=acf2(get(paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s))$residuals, 
                       main = paste0("SARIMA(", p, ",", d, ",", q, ")x(", P, ",", D, ",", Q, ")_", s, "  AICc = ", Data[i,2]))
              i=i+1}}}}}}}}
                  

```



```{r}     
          acf2(assign(paste0("SARIMA(", p, "_1_", q, ")x(0,1,0)_", s), arima(Mortality_1, order=c(p,0,q), seasonal=list(order=c(0,1,0), period=s), method="ML"))$residuals, main = paste0("SARIMA(", p, "_1_", q, ")x(0,1,0)_", s))}
        else{
          acf2(assign(paste0("SARIMA(", p, "_1_", q, ")x(0,1,0)_", s), arima(Mortality, order=c(p,1,q), seasonal=list(order=c(0,1,0), period=s), method="ML"))$residuals, main = paste0("SARIMA(", p, "_1_", q, ")x(0,1,0)_", s))}}}}}
x=arima(Mortality)
plot(x)
      
    assign(paste0("ARIMA1_", p, "_1_", q), arima(Mortality_1, order=c(p,1,q), seasonal=list(order=c(0,1,0), period=12), method="ML"))
    acf2(assign(paste0("Residuals_ARIMA_0_1_", i,  "_of_", x), arima(Mortality, order=c(0,1,i), method="ML")$residuals), main = paste0("ARIMA_0_1_", i, " of ", x))
    variable1 = paste0("ARIMA_0_1_", i)
    variable2 = paste0("Residuals_ARIMA0_1_", i,  "_of_", x)
}}

```

```{r}

  arima(Mortality, order=c(1,1,1), seasonal = list(order = c(0,1,1), period = 0), method="ML")
  acf2(x
# Model
Model1 = arima(Mortality.stat, order=c(0,1,1), seasonal = list(order = c(0,1,1), period = 12), method="ML")

Model1

x = acf2(Model1)

AICc(Model1)



x=residuals(covid["new_cases_smoothed"])


x

arima(Mortality, order=c(4,1,5), seasonal = list(order = c(1,0,1), period = 7), method = "ML")

AICc(arima(Mortality, order=c(0,1,3), seasonal = list(order = c(0,1,1), period = 12), method="ML"));
[1] -441.0091
arima(Mortality, order=c(0,1,3), seasonal = list(order = c(0,1,1), period = 12), fixed = c(NA, 0, NA, NA),
method="ML")
ma1 ma2 ma3 sma1 -0.3353 0 -0.1612 -0.5782
s.e. 0.0810 0 0.0852 0.0796
sigma^2 estimated as 0.00127: log likelihood = 225.38, aic = -442.76
AICc(arima(Mortality, order=c(0,1,3), seasonal = list(order = c(0,1,1), period = 12), fixed = c(NA, 0, NA, NA), method="ML")) [1] -442.4489
32
polyroot(c(1, 0.87, 0.76))
  • To check invertibility of MA part of model A:
source("plot.roots.R")
plot.roots(NULL,polyroot(c(1, -0.3353, 0, -0.1612)), main="(A) roots of ma part, nonseasonal ")
• Diagnostic checking of model B:
fit <- arima(Mortality, order=c(0,1,1), seasonal = list(order = c(0,1,1), period = 12), method="ML")
res <- residuals(fit)
hist(res,density=20,breaks=20, col="blue", xlab="", prob=TRUE)
m <- mean(res)
std <- sqrt(var(res))
curve( dnorm(x,m,std), add=TRUE )
plot.ts(res)
fitt <- lm(res ~ as.numeric(1:length(res))); abline(fitt, col="red")
abline(h=mean(res), col="blue")
qqnorm(res,main= "Normal Q-Q Plot for Model B")
qqline(res,col="blue"
acf(res, lag.max=40)
pacf(res, lag.max=40)
shapiro.test(res)
Box.test(res, lag = 12, type = c("Box-Pierce"), fitdf = 2) Box.test(res, lag = 12, type = c("Ljung-Box"), fitdf = 2)
Box.test(res^2, lag = 12, type = c("Ljung-Box"), fitdf = 0)
acf(res^2, lag.max=40)
ar(res, aic = TRUE, order.max = NULL, method = c("yule-walker"))

• Forecasting using model A:
install.packages("forecast")
library(forecast)
fit.A <- arima(Mortality, order=c(0,1,3), seasonal = list(order = c(0,1,1), period = 12),
fixed = c(NA, 0, NA, NA), method="ML")
forecast(fit.A) % prints forecasts with prediction bounds in a table
• To produce graph with 12 forecasts on transformed data:
pred.tr <- predict(fit.A, n.ahead = 12)
U.tr= pred.tr$pred + 2*pred.tr$se % upper bound of prediction interval L.tr= pred.tr$pred - 2*pred.tr$se % lower bound
ts.plot(Mortality, xlim=c(1,length(Mortality)+12), ylim = c(min(Mortality),max(U.tr)))
lines(U.tr, col="blue", lty="dashed")
lines(L.tr, col="blue", lty="dashed")
points((length(Mortality)+1):(length(Mortality)+12), pred.tr$pred, col="red")
34

  • To produce graph with forecasts on original data:
pred.orig <- exp(pred.tr$pred)
U= exp(U.tr)
L= exp(L.tr)
ts.plot(Mortality, xlim=c(1,length(Mortality)+12), ylim = c(min(Mortality),max(U))) lines(U, col="blue", lty="dashed")
lines(L, col="blue", lty="dashed")
points((length(Mortality)+1):(length(Mortality)+12), pred.orig, col="red")
• To zoom the graph, starting from entry 100:
ts.plot(Mortality, xlim = c(100,length(Mortality)+12), ylim = c(250,max(U))) lines(U, col="blue", lty="dashed")
lines(L, col="blue", lty="dashed")
points((length(Mortality)+1):(length(Mortality)+12), pred.orig, col="red")
• To plot zoomed forecasts and true values (in Mortality):
ts.plot(Mortality, xlim = c(100,length(Mortality)+12), ylim = c(250,max(U)), col="red") lines(U, col="blue", lty="dashed")
lines(L, col="blue", lty="dashed")
points((length(Mortality)+1):(length(Mortality)+12), pred.orig, col="green")
points((length(Mortality)+1):(length(Mortality)+12), pred.orig, col="black")


```

```{r}



```

```{r}



```

```{r}



```


```{r}
Mortality.diff7 = diff(Mortality, lag=7, differences=2)
Mortality.diff8 = diff(Mortality.diff7, 1)
plot.ts(Mortality.diff)
Mortality.diff_acf1
acf2(Mortality.diff7)

acf2(Mortality.diff8)
var(Mortality.diff)

Mortality.diff2 = diff(Mortality, 2)
plot.ts(Mortality.diff2)
Mortality_acf2 = acf2(Mortality.diff2)
var(Mortality.diff2)

Mortality.diff3 = diff(Mortality, 3)
plot.ts(Mortality.diff3)
Mortality_acf3 = acf2(Mortality.diff3)
var(Mortality.diff3)

Mortality.diff4 = diff(Mortality, 4)
plot.ts(Mortality.diff4)
Mortality_acf4 = acf2(Mortality.diff4)
var(Mortality.diff4)
adf.test
# Diff = 1
var(Mortality.diff) < var(Mortality.diff2)

ar1 = ar(Mortality.diff, aic = FALSE, method="mle") # 12
ar2 = ar(Mortality.diff, aic = FALSE, method="yw") # 29
ar3 = ar(Mortality.diff, aic = TRUE, method="mle") # 10
ar4 = ar(Mortality.diff, aic = TRUE, order.max = 12, method="yw") # 10

source("innovations.R")

acvf = acf(Mortality.diff, plot=FALSE, lag.max = length(Mortality.diff))$acf[,1,1] * var(Mortality.diff) 
m = length(acvf)
lh.ia = innovations.algorithm(m+1, acvf)
lh.ia$thetas[9,1:9] # Preliminary estimates of coefficients for MA(9)
lh.ia$thetas[10,1:10] # Preliminary estimates of coefficients for MA(10)
lh.ia$thetas[11,1:11] # Preliminary estimates of coefficients for MA(11)
lh.ia$thetas[12,1:12] # Preliminary estimates of coefficients for MA(12)

arima1 <- auto.arima(Mortality, start.p = 0, start.q = 0, d=1, start.P = 0, start.Q = 0, stationary=TRUE, seasonal = TRUE, allowmean=TRUE, trace = TRUE) # 5,0,0

fit.ar1 <- arima(Mortality.diff8, order=c(1,1,7), seasonal=list(order=c(6,2,2), period=7))

fit.ar1.1 <- arima(Mortality.diff8, order=c(1,1,7), seasonal=list(order=c(4,2,2), period=7), fixed=c(NA,NA,NA,0,0,NA,NA,NA,NA,NA,NA,NA,NA,NA))

a=acf2(fit.ar1.1$residuals)
acf2(fit.ar1$residuals)
a
fit.ar1
fit.ar2 <- arima(Mortality.diff8, order=c(7,1,7), seasonal=list(order=c(6,2,1), period=7))
acf2(fit.ar2$residuals)

fit.ar2 <- arima(Mortality.diff, order=c(0,0,0))

acf1 = acf2(fit.ar1$residuals)
acf1

fit.ar2 <- arima(Mortality, order=c(8,1,1))
fit.ar2 
acf2 = acf2(fit.ar2$residuals)
acf1 = acf2(fit.ar1$residuals)

fit.sarima = astsa::sarima(Mortality,8,1,1,0,1,0,7, model=TRUE)
acf2(fit.sarima$fit$residuals)

fit.ar3.1
fit.ar3.2

fit.ar3.1 <- arima(Mortality, transform.pars = TRUE, method="ML", order=c(0,1,10), seasonal=list(order=c(0,1,1), period=14), include.mean=TRUE, fixed=c(NA,NA,NA,NA,NA,NA,NA,NA,0,NA,NA))

fit.ar3.2 <- arima(Mortality, transform.pars = TRUE, method="ML", order=c(0,1,10), seasonal=list(order=c(0,1,1), period=14), include.mean=TRUE)
acf2(fit.ar3.1$residuals)

acf2(fit.ar3.2$residuals)
                 
fit.ar3 <- arima(Mortality, order=c(0,1,15), seasonal=list(order=c(0,1,1), period=14), fixed=c(NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0,0,0,0,0,NA), a)

fit.ar4 <- arima(Mortality, order=c(0,1,7), seasonal=list(order=c(0,1,1), period=14))

fit.ar5 <- arima(Mortality, order=c(5,1,10), seasonal=list(order=c(0,1,1), period=14))
fit.ar5
acf5


fit.ar5.1 <- arima(Mortality, order=c(5,1,), seasonal=list(order=c(0,1,1), period=14), fixed = c(0,NA,0,0,NA,0,0,0,0,0,0,NA,NA))

fit.ar5.1
fit.ar5
plot(fit.ar5)
acf3 = acf2(fit.ar3$residuals)
acf3.1 = acf2(fit.ar3.1$residuals)
acf4 = acf2(fit.ar4$residuals)
acf5.1 = acf2(fit.ar5.1$residuals)
acf5 = acf2(fit.ar5$residuals, plot=FALSE)
acf5
fit.ar5
Mortality.diff_acf1 = acf2(Mortality.diff)


fit.ar2 <- arima(Mortality.diff, order=c(10,0,0))
fit.ar3 <- arima(Mortality.diff, order=c(12,0,0))
fit.ar4 <- arima(Mortality.diff, order=c(29,0,0))

fit.ma5 <- arima(Mortality.diff, order=c(0,0,9))
fit.ma6 <- arima(Mortality.diff, order=c(0,0,10))
fit.ma7 <- arima(Mortality.diff, order=c(0,0,11))
fit.ma8 <- arima(Mortality.diff, order=c(0,0,12))

fit.arma9 <- arima(Mortality.diff, order=c(5,0,9)) # 12/14 0.05 < s.e. < 0.21
fit.arma10 <- arima(Mortality.diff, order=c(5,0,10)) # NAN produced
fit.arma11 <- arima(Mortality.diff, order=c(5,0,11)) # all 0.07 < s.e. < 0.77
fit.arma12 <- arima(Mortality.diff, order=c(5,0,12)) # 13/17 0.05 < s.e. < 0.837

fit.arma13 <- arima(Mortality.diff, order=c(10,0,9)) # NAN produced
fit.arma14 <- arima(Mortality.diff, order=c(10,0,10)) # 18/20  0.05 < s.e. < 0.099
fit.arma15 <- arima(Mortality.diff, order=c(10,0,11)) # all 0.97 < s.e. < 0.32
fit.arma16 <- arima(Mortality.diff, order=c(10,0,12)) # all 0.12 < s.e. < 0.61

fit.arma17 <- arima(Mortality.diff, order=c(12,0,9)) # all 0.05 < s.e. < 0.60
fit.arma18 <- arima(Mortality.diff, order=c(12,0,10)) # NAN produced
fit.arma19 <- arima(Mortality.diff, order=c(12,0,11)) # NAN produced
#fit.arma20 <- arima(Mortality.diff, order=c(12,0,12)) # all 0.09 < s.e. < 0.37
#fit.arma21 <- arima(Mortality.diff, order=c(29,0,9)) # NAN produced
#fit.arma22 <- arima(Mortality.diff, order=c(29,0,10)) # NAN produced
# fit.arma23 <- arima(Mortality.diff, order=c(29,0,11)) # NAN produced
# fit.arma24 <- arima(Mortality.diff, order=c(29,0,12)) # NAN produced

# STATIONARY
fit.arma25_10 <- arima(Mortality.diff, order=c(25,0,10)) # NAN produced
# STATIONARY w/out NANs for s.e. 
fit.arma25_9 <- arima(Mortality.diff, order=c(25,0,9)) # NAN produced

Data <- data.frame(c(AICc(fit.ar1),
AICc(fit.ar2),
AICc(fit.ar3),
AICc(fit.ar4),
AICc(fit.ma5),
AICc(fit.ma6),
AICc(fit.ma7),
AICc(fit.ma8),
AICc(fit.arma9),
AICc(fit.arma10),
AICc(fit.arma11),
AICc(fit.arma12),
AICc(fit.arma13),
AICc(fit.arma14),
AICc(fit.arma15),
AICc(fit.arma16),
AICc(fit.arma17),
AICc(fit.arma18),
AICc(fit.arma19),
#AICc(fit.arma20),
#AICc(fit.arma21),
#AICc(fit.arma22),
AICc(fit.arma25_10),
AICc(fit.arma25_9)))

rownames(Data) <- c("AR(5)", "AR(10)", "AR(12)", "AR(29)", "MA(9)", "MA(10)", "MA(11)", "MA(12)", "ARMA(5,9)", "ARMA(5,10)", "ARMA(5,11)", "ARMA(5,12)", "ARMA(10,9)", "ARMA(10,10)", "ARMA(10,11)", "ARMA(10,12)", "ARMA(12,9)", "ARMA(12,10)", "ARMA(12,11)", "ARMA(25,10)", "ARMA(25,9)")
colnames(Data) <- c("AICc")

Data["Lowest AICc"] <- as.integer(rank(Data$AICc))
Data

acf1 = acf2(fit.ar1$residuals)
acf2 = acf2(fit.ar2$residuals)
acf3 = acf2(fit.ar3$residuals)
acf4 = acf2(fit.ar4$residuals)
acf5 = acf2(fit.ma5$residuals)
acf6 = acf2(fit.ma6$residuals)
acf7 = acf2(fit.ma7$residuals)
acf8 = acf2(fit.ma8$residuals)
acf9 = acf2(fit.arma9$residuals)
acf10 = acf2(fit.arma10$residuals)
acf11 = acf2(fit.arma11$residuals)
acf12 = acf2(fit.arma12$residuals)
acf13 = acf2(fit.arma13$residuals)
acf14 = acf2(fit.arma14$residuals)
acf15 = acf2(fit.arma15$residuals)
acf16 = acf2(fit.arma16$residuals)
acf17 = acf2(fit.arma17$residuals)
acf18 = acf2(fit.arma18$residuals)
acf19 = acf2(fit.arma19$residuals)
#acf20 = acf2(fit.arma20$residuals)
#acf21 = acf2(fit.arma21$residuals)
#acf22 = acf2(fit.arma22$residuals)
acf23 = acf2(fit.arma25_10$residuals)
acf24 = acf2(fit.arma25_9$residuals)

```
